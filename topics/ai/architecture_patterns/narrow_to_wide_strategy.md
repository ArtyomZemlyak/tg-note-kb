# Стратегия Narrow-to-Wide в архитектурах нейронных сетей

## Общее описание

Стратегия Narrow-to-Wide - это архитектурный принцип, при котором ширина подсетей постепенно увеличивается от ранних слоёв к более глубоким. В этой схеме узкие (меньше каналов) слои обрабатываются с большим количеством блоков, а широкие слои - с меньшим количеством блоков, что позволяет эффективно распределять вычислительные ресурсы и балансировать нагрузку по всей глубине нейронной сети.

## Принцип работы

### Распределение вычислительной нагрузки

В традиционных архитектурах вся ширина сети определяется с самого начала, что приводит к равномерному распределению вычислительных ресурсов по всей глубине сети. В стратегии Narrow-to-Wide применяется иной подход:

- **Ранние этапы** (через которые проходит больше всего блоков) работают с узкими каналами, экономя FLOPs
- **Поздние этапы** (через которые проходит меньше блоков) работают с широкими каналами, обеспечивая богатое представление

### Математическая формулировка

При геометрическом увеличении ширины: C_i ≈ C_{i+1} / √2, где C_i - ширина (количество каналов) на i-м шаге. Такое распределение позволяет сбалансировать вычислительную нагрузку и улучшить эффективность использования параметров.

## Применение в Step by Step Networks (StepsNet)

Стратегия Narrow-to-Wide является ключевым компонентом архитектуры StepsNet:

### Каскадная обработка
- Входные данные разделяются на "медленный путь" (x_1) и "быстрый путь" (x_2)
- "Медленный путь" проходит через ранние узкие подсети с большим количеством блоков
- "Быстрый путь" поступает в более глубокие широкие подсети "чистыми", без шума от ранних блоков

### Пример формулировки
```
y_1 = F_1(x_1)  # Узкая подсеть с большим количеством блоков
y_2 = F_2([y_1, x_2])  # Широкая подсеть с меньшим количеством блоков
```

## Преимущества стратегии

### Экономия вычислительных ресурсов
- Ранние узкие слои потребляют меньше памяти и вычислительных ресурсов
- Позволяет создавать более глубокие сети при тех же вычислительных ограничениях

### Улучшенное качество передачи сигнала
- "Чистые" пути для информации, поступающей в глубокие слои
- Снижение деградации шорткатов за счёт поддержания здорового соотношения сигнал/шум

### Эффективное масштабирование
- Позволяет масштабировать модели до сотен слоёв
- Лучшее соотношение параметров к производительности

## Применение в других архитектурах

### Обработка изображений
- Может применяться в CNN архитектурах для улучшения масштабируемости
- Улучшает качество представлений на разных уровнях иерархии

### Обработка последовательностей
- Применимо к трансформерам и рекуррентным сетям
- Позволяет эффективно обрабатывать разные уровни абстракции

## Сравнение с другими стратегиями

### Традиционная широкая архитектура
- Равномерное распределение ширины по всей глубине
- Может быть менее эффективной с точки зрения FLOPs и памяти

### ResNet-подобные архитектуры
- Сохраняют постоянную ширину в пределах макроблоков
- Не используют динамическое изменение ширины для оптимизации нагрузки

![Архитектуры Swin с различными стратегиями](../../../media/img_1764253717_aqadka1rgr9qul_14_architectures_of_swin.jpg)

**Описание:** На изображении показаны различные архитектуры Swin с разными подходами к организации ширины и глубины, включая стратегию narrow-to-wide, применяемую в StepsNet.

## Практические рекомендации

### Выбор соотношения ширины
- Рекомендуется геометрический рост (C_i ≈ C_{i+1} / √2) для оптимального баланса
- Параметры должны быть настроены экспериментально для конкретной задачи

### Интеграция с существующими архитектурами
- Может быть применена как обертка к существующим блокам
- Совместима с различными типами нейронных слоёв

## Связи с другими темами

- [[stepsnet_architecture.md]] - основное применение стратегии Narrow-to-Wide
- [[shortcut_degradation_problem.md]] - проблема, которую решает стратегия
- [[vision_transformer.md]] - контекст архитектур, к которым может быть применена стратегия
- [[residual_networks.md]] - сравнение с традиционными подходами
- [[deep_network_scaling.md]] - общая тема масштабирования глубоких сетей

## Источники

1. [Step by Step Network](https://arxiv.org/abs/2511.14329) - статья Dongchen Han и др., где впервые подробно описана и реализована стратегия Narrow-to-Wide в архитектуре StepsNet, arXiv:2511.14329, ноябрь 2025.
2. [ArXivIQ Review: Step by Step Network](https://arxiviq.substack.com/p/step-by-step-network) - обзор статьи с объяснением стратегии Narrow-to-Wide и её преимуществ.