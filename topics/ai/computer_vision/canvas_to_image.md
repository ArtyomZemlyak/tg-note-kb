# Canvas-to-Image: Многофункциональный подход к пространственному управлению генерацией изображений

## Обзор

Canvas-to-Image — это унифицированный фреймворк для генерации изображений, разработанный командой Snap Research, который кодирует разнообразные сигналы управления в композитное изображение-холст для генерации высококачественных мультимодальных изображений. Основная идея заключается в объединении различных способов управления изображением в едином canvas (холсте), что позволяет модели напрямую интерпретировать визуально-пространственное мышление. Фреймворк консолидирует разнородные сигналы управления (текстовые промпты, эталонные объекты, пространственные расположения, ограничения позы, разметку макета) в один интерфейс холста, позволяя генерировать изображения, точно отражающие намерения пользователя.

## Ключевые особенности

### Многофункциональный холст (Multi-Task Canvas)
- Объединяет разнородные сигналы управления в одном интерфейсе холста
- Включает текстовые промпты, эталонные объекты, пространственные расположения, ограничения позы и разметку макета
- Позволяет модели лучше понимать визуально-пространственное мышление и интегрированное визуально-пространственное рассуждение

### Многофункциональная стратегия обучения (Multi-Task Canvas Training)
- Оптимизирует диффузионную модель для совместного понимания и интеграции разнородных сигналов управления
- Объединяет текст-в-изображение генерацию с мультимодальными сигналами управления в единой парадигме обучения
- Использует разные задачи во время обучения, каждая из которых фокусируется на одной модальности управления, что позволяет модели хорошо понимать отдельные элементы

### Обучение и инференс
- Во время обучения используется отдельный canvas для каждой модальности управления, что позволяет модели хорошо понимать отдельные элементы
- На этапе инференса можно свободно комбинировать несколько модальностей (боксы, позы и т.д.)
- Обеспечивает бесшовную интеграцию объектов, поз и пространственных представлений в сложные структуры
- Позволяет модели естественным образом выявлять взаимосвязи между различными модальностями

## Архитектура и технические детали

### Композитное кодирование холста
- Разнообразные сигналы управления кодируются в одно композитное изображение-холст
- Включает эталонные объекты, ограничивающие рамки (bounding boxes), скелеты позы и другие сигналы управления
- Позволяет модели напрямую интерпретировать визуально-пространственное мышление

### Многофункциональная стратегия обучения
- Совместная оптимизация диффузионной модели для понимания и интеграции разнородных сигналов управления
- Объединяет текст-в-изображение генерацию с мультимодальными сигналами управления в единой парадигме обучения
- Кураторство многофункциональных датасетов для обучения

### Обработка входных данных
- Модель принимает композитное изображение-холст, содержащее различные сигналы управления
- Диффузионная модель оптимизирована для понимания и интеграции разнородных сигналов управления
- Обеспечивает интегрированное визуально-пространственное рассуждение

## Данные и обучение

### Источники данных
- Spatial и Pose Canvas получены из собственного датасета на 6М семплов от 1М уникальных пользователей
- Box Canvas получены из внутреннего датасета, который дополнительно размечен боксами из CreatiDesign датасета

### Бенчмарки
- Авторы ввели сложный бенчмарк для оценки пространственной генерации
- Это позволяет точно измерять качество пространственного контроля в генерации изображений

## Применение и возможности

### Консистентная генерация
- Подход позволяет добавлять референсы на фото и делать консистентную генерацию
- Пример: возможность добавить людей на фотографии, если они не смогли поехать с друзьями в отпуск

### Пространственный контроль
- Высокая точность в пространственном контроле объектов на изображениях
- Возможность точного задания позиции, ориентации и взаиморасположения объектов

## Экспериментальные результаты

### Основные достижения
- Значительное превосходство над современными методами в сохранении идентичности и соблюдении контроля
- Успех в сложных бенчмарках, включая:
  - Композицию нескольких человек
  - Композицию с контролем позы
  - Генерацию с ограничениями макета
  - Генерацию с несколькими контролами
- Обобщение на сценарии с несколькими контролами во время инференса

## Ограничения

### Проблема переполнения canvas
- Canvas может быть переполненным (например: объекты сильно перекрывают друг друга), что ухудшает качество генерации в рамках RGB представления
- Исправление возможно введением альфа-канала RGBA, но авторы не проводили таких исследований

## Сравнение с другими подходами

| Подход | Преимущества | Особенности |
|--------|-------------|-------------|
| Canvas-to-Image | Многофункциональность, пространственный контроль | Единый canvas для разных модальностей |
| Z-Image Turbo | Быстрая генерация | Single-Stream Diffusion Transformer архитектура |
| Generative Segmentation-as-Editing | Точный контроль на уровне пикселей | Объединение сегментации и редактирования |

## Связи с другими темами

- [[generative_segmentation_as_editing.md]] - Парадигма генеративной сегментации как редактирования, схожа по цели точного пространственного контроля
- [[qwen-vl-series.md]] - Визуально-языковая модель, потенциальная основа архитектуры Canvas-to-Image
- [[image_generation.md]] - Общие принципы генерации изображений, включая диффузионные модели
- [[canvas_representation_for_reasoning.md]] - Подход к представлению визуальных задач на холсте, схожий по концепции
- [[diffusion_transformer.md]] - Архитектура трансформеров в диффузионных моделях, используемых в системе
- [[diffusion_models.md]] - Диффузионные модели, лежащие в основе подхода
- [[multimodal_models.md]] - Мультимодальные модели, используемые для объединения различных сигналов управления

## Значение для ИИ

Canvas-to-Image представляет собой важный шаг вперед в области генерации и редактирования изображений, позволяя более точно и контролируемо управлять пространственным размещением объектов и их свойствами. Это открывает новые возможности для более сложного и детализированного ИИ-ассистированного создания изображений с высокой степенью контроля над результатом.

## Источники

1. [Canvas-to-Image: Compositional Image Generation with Multimodal Controls](https://arxiv.org/abs/2511.21691) - Основная научная статья, описывающая подход Canvas-to-Image от Snap Research
2. [Snap Research - Canvas-to-Image GitHub Repository](https://github.com/snap-research/canvas-to-image) - Репозиторий с реализацией и дополнительной информацией
3. [Canvas-to-Image: Compositional Image Generation with Multimodal Controls](https://huggingface.co/papers/2511.21691) - Страница с подробным описанием и анализом статьи

## Дополнительные материалы

- [Canvas-to-Image: Hugging Face Page](https://huggingface.co/papers/2511.21691) - Детализированное описание подхода, методологии и результатов
- [Compositional Image Generation with Multimodal Controls - YouTube Overview](https://www.youtube.com/watch?v=RGn04o661sA) - Объяснение ключевых концепций подхода