# ControlNet в генерации изображений

```metadata
category: computer_vision
subcategory: image_generation
tags: controlnet, image-generation, computer-vision, conditional-generation, stable-diffusion
```

## Определение

ControlNet - это мощная нейронная сеть, которая позволяет добавлять дополнительные условия к моделям генерации изображений, таким как Stable Diffusion или Z-Image Turbo. Это позволяет пользователям получать точный контроль над процессом генерации, используя визуальные подсказки в дополнение к текстовым запросам.

## Архитектура

ControlNet архитектура основана на добавлении дополнительных "управляющих" потоков к существующим диффузионным моделям без необходимости перетренировки основной модели. Контрольные условия могут включать:

- Карты краев (Canny)
- Карты глубины (Depth)
- Карты нормалей (Normal Maps)
- Позы человека (Pose)
- Линейные сегменты (MLSD)
- Эскизы и наброски (Scribble/Sketch)

## Типы ControlNet

### Canny ControlNet
Использует карты краев Canny для сохранения общей структуры изображения. Эффективен для генерации изображений с сохранением архитектурных линий и общего макета.

### HED (Holistically-Nested Edge Detection) ControlNet
Глубокое обнаружение краев, обеспечивающее более детализированные и точные контуры по сравнению с Canny.

### Depth ControlNet
Использует карты глубины для сохранения пространственной структуры сцены, что особенно полезно для сохранения перспективы и расстояний в генерируемом изображении.

### Pose ControlNet
Обнаруживает позы человека и позволяет генерировать изображения с заданными позами, что особенно полезно для генерации людей и персонажей. Pose ControlNet может использовать различные подходы для оценки позы:

- **2D Pose estimation**: Обнаружение ключевых точек тела на изображении
- **OpenPose**: Популярная модель для оценки позы, которая создает скелетную структуру из ключевых точек
- **3D pose reference**: Использование 3D-скелетов в качестве более точного референса для позы

### OpenPose ControlNet
OpenPose ControlNet специализированная модель ControlNet, предназначенная для контроля поз человека в изображениях. Она анализирует позы людей на входных изображениях и помогает ИИ генерировать новые изображения, соответствующие заданным позам. OpenPose детектирует позы людей из входного изображения и превращает их в скелетную карту, которая направляет ИИ при генерации новых изображений, соответствующих заданной позе.

### MLSD (Multi-scale Line Segment Detection) ControlNet
Обнаруживает линейные сегменты на разных масштабах, эффективно сохраняя геометрическую структуру архитектурных и технических сцен.

## Применение

ControlNet позволяет:
- Сохранять структуру при генерации изображений по текстовому запросу
- Контролировать позы, глубину и линии в генерируемых изображениях
- Создавать изображения с точным контролем над пространственными аспектами
- Редактировать изображения с сохранением исходной структуры
- Интегрировать визуальные и текстовые подсказки для лучшего результата
- Использовать редактирующие модели (editing models) для модификации существующих изображений
- Применять 3D-скелеты в качестве более точного референса для позы
- Сохранять позу с изображения и трансформировать персонажа в другой лук

## Примеры использования

- Генерация архитектурных визуализаций с сохранением линий и углов
- Создание изображений с заданными позами людей
- Сохранение перспективы при изменении сцены
- Структурное редактирование изображений
- Генерация изображений с контролируемыми краями и деталями

## Интеграция с моделями

ControlNet может быть интегрирован с различными диффузионными моделями:
- Stable Diffusion (оригинальная интеграция)
- Z-Image Turbo (новая интеграция от Alibaba)
- Другие диффузионные модели

## Связи с другими темами

- [[z_image_turbo_controlnet.md]] - Интеграция ControlNet с Z-Image Turbo
- [[image_generation.md]] - Общая информация о генерации изображений
- [[z_image_turbo.md]] - Ускоренная модель генерации от Alibaba
- [[diffusion_models.md]] - Диффузионные модели для генерации изображений
- [[pose_estimation_in_image_generation.md]] - Оценка позы в генерации изображений
- [[editing_models_and_controlnet.md]] - Редактирующие модели и ControlNet

## Источники

1. [Hugging Face Diffusers: ControlNet Documentation](https://huggingface.co/docs/diffusers/using-diffusers/controlnet) - Официальная документация ControlNet
2. [Stable Diffusion Art: Complete Guide to ControlNet](https://stable-diffusion-art.com/controlnet/) - Руководство по ControlNet
3. [ML Conference: ControlNet Image Generation](https://mlconference.ai/generative-ai-content/controlnet-image-generation/) - Обзор ControlNet
4. [Iterate.AI: ControlNet Glossary](https://www.iterate.ai/ai-glossary/what-is-controlnet) - Определение и объяснение ControlNet