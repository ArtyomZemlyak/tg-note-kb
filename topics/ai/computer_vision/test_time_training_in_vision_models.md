# Test-Time Training (TTT) в визуальных моделях

## Описание

Test-Time Training (TTT) в визуальных моделях — это парадигма машинного обучения, при которой модель продолжает обучаться и адаптироваться к новым данным во время фазы инференса (вывода), в частности адаптируясь к специфическим визуальным паттернам или задачам. В отличие от традиционного подхода, при котором обучение завершается до развертывания модели, TTT в визуальных моделях позволяет адаптироваться к новым визуальным задачам, доменам или стилям без явной фазы переобучения.

## Основная информация

TTT в визуальных моделях представляет собой фундаментальный сдвиг от традиционной парадигмы машинного обучения, где модели полностью обучаются на этапе обучения и остаются статичными во время инференса. В визуальных моделях TTT позволяет адаптироваться к новым паттернам в визуальных данных в реальном времени, что особенно полезно в сценариях, таких как:
- Адаптация к новым визуальным доменам
- Компенсация смещения визуальных данных
- Адаптация к индивидуальным особенностям конкретных визуальных входов
- Задачи, требующие визуального рассуждения (например, ARC)

## Технические детали

### Общий принцип в визуальных моделях

В традиционном обучении модель обучается минимизировать функцию потерь на визуальных обучающих данных:

```
min_θ E_{(x,y)~D_train}[L(f_θ(x), y)]
```

В TTT визуальная модель дополнительно адаптируется к каждому визуальному входному примеру x во время инференса:

```
θ'(x) = θ - η ∇_θ L(f_θ(x), pseudo_label(x))
```

где `pseudo_label(x)` - это сгенерированная визуальная метка или целевая функция для адаптации.

### Псевдо-обучение в визуальных задачах

Поскольку на этапе инференса неизвестны истинные визуальные метки, TTT в визуальных моделях использует различные методы для генерации псевдометок:
- Восстановление изображения или его частей как задача для адаптации
- Использование геометрических аугментаций (повороты, отражения) как цели
- Консистентность с соседними визуальными примерами
- Использование вспомогательной модели для генерации визуальных целей

### Применение в VARC

В фреймворке VARC (Vision ARC), TTT используется для адаптации модели к конкретной задаче ARC:
- Демонстрационные пары (x_i, y_i) аугментируются геометрически (повороты, отражения, перестановки цветов)
- Веса модели обновляются для минимизации попиксельного лосса кросс-энтропии на этих аугментированных демо
- Это позволяет модели "оверфитнуться" под правило конкретной задачи перед предсказанием

## Применение и результаты

![Эффект Test-Time Training](../../../media/img_1764033898_aqadpa9rg9mngul9_figure_6_effect_of_test_time_training.jpg)

**Описание:** На изображении показан эффект применения Test-Time Training в визуальных моделях, демонстрируется улучшение результатов при использовании TTT по сравнению с подходами без него.

### Задачи, в которых используется TTT в визуальных моделях
- Адаптация к новым визуальным доменам (domain adaptation)
- Компенсация смещения визуальных данных
- Адаптация к индивидуальным предпочтениям в визуальных задачах
- Обработка визуальных данных с новыми паттернами или шумом
- Визуальные задачи с длинным контекстом, где модель должна адаптироваться к новым сценариям
- **Визуальное рассуждение** (как в VARC) - адаптация к специфическим правилам обработки визуальных данных

### Результаты в VARC
- В VARC TTT позволяет модели адаптироваться к специфическим правилам трансформации для новой тестовой задачи
- Значительное улучшение результатов (до 60.4% в ансамбле по сравнению с 54.5% без TTT для отдельной модели)
- Возможность "оверфиттинга" под правило конкретной задачи перед предсказанием

## Сравнение с другими архитектурами визуальных моделей

### Отличия от тестовой адаптации без обучения
- TTT: адаптирует параметры модели во время инференса
- Тестовая адаптация: использует фиксированные параметры, но адаптирует нормализацию или другие компоненты

### Отличия от Titans
- TTT: универсальный подход к адаптации во время инференса в визуальных задачах
- Titans: целенаправленная архитектура с LMM, механизмом "удивления" и адаптивным забыванием
- Визуальные задачи могут требовать отличных подходов к адаптации по сравнению с текстовыми

## Практические аспекты

### Реализация в визуальных моделях
- Необходимость в поддержке обновлений параметров во время инференса для визуальных архитектур (ViT, U-Net и др.)
- Баланс между скоростью обновления и стабильностью визуальных представлений
- Управление вычислительными ресурсами для обучения во время визуального инференса
- Генерация подходящих псевдометок для обучения на визуальных данных

### Преимущества
- Адаптация к изменяющимся визуальным данным без переобучения
- Возможность компенсации смещения визуального домена
- Повышенная персонализация для конкретных визуальных входов
- Возможность непрерывного обучения визуальных представлений

### Ограничения
- Высокая вычислительная стоимость визуального инференса из-за адаптации
- Потенциальные проблемы с нестабильностью визуальных представлений
- Риск забывания предыдущих визуальных знаний
- Требует тщательной настройки для избежания переобучения на одиночных визуальных примерах

## Значение для ИИ

TTT в визуальных моделях представляет собой важную концепцию, которая демонстрирует потенциал непрерывного обучения и адаптации визуальных моделей в реальном времени. В частности, его успешное применение в VARC показывает, что адаптивность может быть критична для задач, требующих визуального рассуждения. Хотя TTT может быть менее эффективной по сравнению с более целенаправленными подходами, он указывает на важность адаптивности в современных ИИ-системах, особенно для визуального восприятия и рассуждения.

## Визуализации

![Пример процесса обучения визуальной модели во время инференса](../../../images/ttt_visual_model_adaptation.png) <!-- TODO: Broken image path --> <!-- TODO: Добавить визуализацию процесса TTT в визуальных моделях -->

## Связи с другими темами

- [[../../llm/architectures/test_time_training.md]] - Общая концепция TTT
- [[canvas_representation_for_reasoning.md]] - Применение TTT с canvas representation в VARC
- [[vision_arc_varc.md]] - Конкретное применение TTT в визуальных задачах рассуждения
- [[vision_transformer.md]] - Vision Transformer как архитектура, поддерживающая TTT
- [[continual_learning/continual_learning.md]] - Общая область, к которой относится TTT
- [[domain_adaptation.md]] - Связанная концепция адаптации к новым доменам
- [[../../recsys/transformer_based_models.md]] - Сравнение с применением TTT в других архитектурах

## Источники

1. [ARC Is a Vision Problem!](https://arxiv.org/abs/2511.14761) - Оригинальная статья, в которой TTT используется в визуальных моделях для задач ARC, Keya Hu, Ali Cy, Linlu Qiu и др., ноябрь 2025
2. [VARC GitHub Repository](https://github.com/lillian039/VARC) - Код реализации VARC с применением TTT в визуальных моделях
3. [Test-Time Training: How to Use the Future to Predict the Present](https://arxiv.org/abs/2206.01251) - Оригинальная статья, описывающая парадигму Test-Time Training
4. [Titans: Learning to Memorize at Test Time](https://arxiv.org/abs/2501.00663) - Сравнение TTT с более целенаправленными архитектурами адаптации