# Matryoshka Representation Learning (MRL)

## Описание

Matryoshka Representation Learning (MRL) - это подход к обучению представлений, предназначенный для сжатия векторного пространства. Название происходит от аналогии с матрешкой, где большие структуры содержат в себе меньшие, подобные им.

## Архитектура и принцип работы

### Основная идея
- Входной вектор размера N → векторы различных размерностей от N до 64
- Независимый расчет InfoNCE Loss для каждого вектора
- Среднее значение принимается как итоговая функция потерь при обучении

### Процесс:
1. Входной вектор заданной размерности (например, 512)
2. Создание векторов меньших размерностей (например, 256, 128, 64) из одного и того же входного вектора
3. Для каждого вектора вычисляется его собственная InfoNCE Loss
4. Среднее значение всех Loss функций используется для обучения модели

## Преимущества

### 1. Ускорение сходимости модели
- Позволяет модели быстрее обучаться за счет многоуровневой оптимизации
- Каждый размер вектора предоставляет свою информацию о сходстве

### 2. Сильное сжатие векторного пространства
- Позволяет эффективно использовать как большие, так и маленькие векторы
- Подходит для сценариев с ограничениями по памяти или скорости

### 3. Ранжирование признаков
- Позволяет идентифицировать наиболее важные признаки для каждого размера вектора
- Помогает в эффективной работе с разными задачами

### 4. Гибкость использования
- Позволяет нарезать N-вектор на любую размерность (например, большая размерность оффлайн, маленькая онлайн)
- Поддерживает разные сценарии использования: точные оффлайн вычисления и быстрые онлайн инференсы

## Применение

### В системе поиска по фото Wildberries:
- Использование: 512-мерные векторы оффлайн и 128-мерные векторы онлайн
- Обеспечивает >3% улучшение на всех ключевых оффлайн метриках без дополнительных данных
- Позволяет использовать более точные векторы в оффлайн обработке и более быстрые - в онлайн инференсе

### В мультимодальных системах:
- Применяется для сжатия визуальных и текстовых эмбеддингов
- Позволяет эффективно работать с разными размерами данных в разных сценариях

## Технические детали

### InfoNCE Loss
- Используется как основная функция потерь для каждого вектора
- Определяет качество представлений на каждом уровне размерности
- Учитывает как положительные, так и отрицательные примеры

### Многоуровневая оптимизация
- Каждый уровень вектора обучается параллельно
- Позволяет сохранить информацию на разных уровнях детализации
- Поддерживает эффективное использование ресурсов

## Примеры использования

### Визуальный поиск
- Обучение эмбеддингов изображений для поиска по схожести
- Позволяет эффективно сопоставлять изображения разного качества

### Натуральный язык
- Сжатие текстовых эмбеддингов для поиска релевантных документов
- Подходит для задач семантического поиска

## Сравнение с другими подходами

### Отличия от традиционного подхода:
- Традиционные методы создают один фиксированный размер вектора
- MRL создает иерархию векторов разных размерностей
- Позволяет использовать один и тот же эмбеддинг для разных задач

## Новые концепции и термины

- **InfoNCE Loss**: функция потерь для обучения контрастивного представления
- **Многоуровневая оптимизация**: подход к обучению, при котором один и тот же вход используется для создания представлений разных размерностей
- **Сжатие векторного пространства**: процесс уменьшения размерности векторов при сохранении ключевой информации

## Примеры применения

### Векторный поиск и рекомендации
- Эффективный поиск ближайших соседей в сжатом пространстве
- Ускорение поиска за счет использования меньших векторов в онлайн-сценариях

## Связи с другими темами

- [[../../computer_vision/vector_search.md]] - Векторный поиск и базы данных
- [[../../computer_vision/visual_search/wildberries_photo_search.md]] - Применение MRL в системе поиска по фото от Wildberries
- [[../../computer_vision/multimodal_models.md]] - Мультимодальные модели, использующие подходы MRL
- [[../self_supervised_learning.md]] - Self-supervised learning: альтернативный подход к обучению представлений, часто используемый в визуальных задачах