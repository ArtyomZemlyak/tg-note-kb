# Двухбашенная архитектура в мультимодальных LLM (Dual-Tower Architecture)

## Описание

Двухбашенная архитектура (dual-tower architecture) - это подход к построению мультимодальных моделей, при котором используются две отдельные, но связанные подмодели (башни) для обработки разных модальностей данных. В контексте мультимодальных LLM одна башня обрабатывает текстовые данные, а другая - визуальные.

## Принцип работы

В двухбашенной архитектуре:
- Каждая башня специализируется на обработке определенной модальности
- Башни могут быть идентичными по архитектуре, но различаться параметрами
- Одна башня может быть заморожена, чтобы сохранить уже приобретенные навыки
- Другая башня дообучается для новой модальности
- Результаты обработки могут быть объединены различными способами

## Пример: X-Fusion

Фреймворк X-Fusion использует двухбашенную архитектуру следующим образом:
- **Первая башня**: Замороженная предобученная LLM, сохраняющая способность к текстовым задачам
- **Вторая башня**: Визуальная башня, дообученная для работы с изображениями
- Это позволяет сохранить текстовые навыки оригинальной модели, добавив способность к визуальной генерации

### Обработка изображений в X-Fusion
- Изображения кодируются с помощью VAE от Stable Diffusion 1.5
- Полученные латентные представления подаются в визуальную башню
- Визуальная башня генерирует соответствующий текстовый или визуальный ответ

### Генерация изображений в X-Fusion
- Модель выбирает токены, соответствующие визуальному контенту
- Токены проходят через диффузионный процесс денойзинга
- Результат декодируется с помощью VAE обратно в изображение

## Преимущества двухбашенной архитектуры

### 1. Сохранение существующих навыков
- Замороженная башня сохраняет уже приобретенные навыки
- Нет риска "забывания" предыдущих задач (catastrophic forgetting)

### 2. Эффективность обучения
- Нужно дообучать только одну башню
- Снижается вычислительная сложность по сравнению с полным переобучением

### 3. Модульность
- Каждая башня может быть оптимизирована под свою модальность
- Возможность замены отдельных башен независимо

### 4. Гибкость
- Возможность использования выходов отдельных башен
- Возможность комбинации выходов с различными весами

## Сравнение с другими архитектурами

| Архитектура | Преимущества | Недостатки | Примеры использования |
|-------------|--------------|------------|----------------------|
| Единая модель | Простота, общее представление | Высокая сложность, переобучение | CLIP, BLIP |
| Две башни | Сохранение навыков, эффективность | Сложность интеграции | X-Fusion |
| Микстура экспертов | Эффективное масштабирование | Сложность в дизайне | Ming, Switch Transformers |
| Слои с вентилями | Гибкая комбинация | Дополнительные параметры | Варианты адаптивных архитектур |

## Обучение двухбашенной архитектуры

### Стратегии обучения:
1. **Асинхронное обучение**: Каждая башня обучается независимо
2. **Последовательное обучение**: Одна башня замораживается при обучении другой
3. **Совместное обучение**: Обе башни обучаются одновременно с штрафами за отклонение

### Проблемы:
- Синхронизация между башнями
- Обеспечение согласованности представлений
- Сложность в комбинации выходов

## Применение в X-Fusion

В фреймворке X-Fusion двухбашенная архитектура решает ключевые задачи:

1. **Сохранение текстовых навыков**: Замороженная LLM сохраняет способность к текстовой генерации и пониманию
2. **Добавление визуальных навыков**: Визуальная башня обучается генерации и пониманию изображений
3. **Эффективное использование ресурсов**: Использование выходов соответствующей башни при необходимости
4. **Интеграция диффузионных и токенных подходов**: Комбинация next-token prediction и диффузионных процессов

## Будущие направления

1. **Адаптивные веса**: Автоматическое определение весов для комбинации выходов башен
2. **Динамическое замораживание**: Адаптивное определение, какие башни замораживать
3. **Многоуровневая интеграция**: Более глубокая интеграция между башнями на уровне скрытых слоев
4. **Масштабирование**: Расширение на большее количество модальностей и башен

## Связи с другими темами

- [[x_fusion.md]] - Основная статья о фреймворке X-Fusion
- [[../../computer_vision/multimodal_models.md]] - Общие мультимодальные модели
- [[../architectures/cross_modality_efficient_architectures.md]] - Эффективные кросс-модальные архитектуры
- [[../../computer_vision/vision_transformer.md]] - Визуальные трансформеры, используемые в визуальной башне

## Источники

1. [CV Time Article: X-Fusion: Introducing New Modality to Frozen Large Language Models](https://cvtime.substack.com/) - Основная статья, описывающая двухбашенную архитектуру в контексте X-Fusion
2. [Attention Is All You Need](https://arxiv.org/abs/1706.03762) - Оригинальная статья о трансформерах, на которых базируются башни