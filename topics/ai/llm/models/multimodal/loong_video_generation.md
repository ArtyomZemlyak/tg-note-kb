# Loong: Генерация минутных видео с помощью авторегрессивных языковых моделей

## Описание

Loong - это авторегрессивная модель для генерации видео на основе LLM (Large Language Model), способная создавать качественные длинные видео даже при обучении только на коротких примерах. Модель была представлена в статье "Loong: Generating Minute-level Long Videos with Autoregressive Language Models", подготовленной командой исследователей из HKU и ByteDance.

## Архитектура

### 1. Видео токенизация

Архитектура Loong начинается с токенизации видео:

- **Энкодер**: MAGViT2 - 3D CNN свёрточная модель, которая обрабатывает темпоральную часть кадров видео
- **Метод**: Использует Clustering Vector Quantization для токенизации
- **Размер**: Токенайзер имеет 246M параметров

### 2. LLM компонент

- **Базовая архитектура**: LLaMa (обучается с нуля)
- **Диапазон параметров**: от 700M до 7B параметров
- **Токены**: 
  - 32 000 токенов для текста
  - 8 192 токенов для видео
  - 10 специальных токенов (вероятно, для разделителей между кадрами)

Согласно [статье о Loong](https://arxiv.org/html/2410.02757v1), авторы учат LLM с нуля, что позволяет модели лучше адаптироваться к задаче генерации видео.

### 3. Декодер

- **Модель**: VQGAN
- **Функция**: Предсказывает изображения - кадры видео на основе выходных векторов LLM

## Особенности обучения

### Проблема лосса

- Лосс в длинной последовательности кадров оказывается меньше, так как видеотокены в одном видео похожи между собой
- Текстовые токены сильно отличаются от видео, что затрудняет генерацию первых кадров
- Для решения авторы предлагают перевешивать лосс ([статья о Loong](https://arxiv.org/html/2410.02757v1))

### Трехстадийное обучение

1. **1-я стадия**: Модель предсказывает только одно изображение
2. **2-я стадия**: Генерируется 1 секунда видео и 17 фреймов
3. **3-я стадия**: Самое длинное видео - 10 секунд

## Основные инновации

### Реинкодинг

Одним из ключевых вкладов в Loong является подход "реинкодинга":

- Модель обучают на десятисекундных видео, что мало для качественного длинного видео
- Для повышения качества генерации предлагается "реинкодинг":
  - Генерировать первые кадры по исходному промпту пользователя
  - Брать в качестве следующего промпта несколько последних кадров получившегося видео и генерировать новое
- Такой подход замедляет инференс, но снижает требования к обучающему датасету

## Обучающие данные

- Loong тренировали на 100M пар «текст + изображение»
- Для первой стадии использовали датасеты LAION-2B и CC12M
- Обучающие видео: 5,5M клипов, отфильтрованных из HDVG

## Сравнение с другими моделями

| Характеристика | Loong | Kandinsky-5 Video Lite |
|----------------|-------|------------------------|
| Архитектура | Авторегрессивная LLM | DiT (Diffusion Transformer) |
| Подход к генерации | Токенизация → LLM → декодирование | Flow matching |
| Длительность видео | До минут | До 10 секунд |
| Размер модели | 700M-7B параметров | 2 млрд. параметров |

## Значимость

Пример Loong подтверждает, что генерировать качественные длинные видео можно, даже если обучать модель только на коротких примерах. Модель открывает новые возможности для генерации длительных видеороликов с помощью авторегрессивных подходов, традиционно использовавшихся для текстовой генерации.

## Связи с другими темами

- [[./magvit2_video_tokenizer.md]] - Токенизатор, используемый в Loong
- [[./vqgan_decoder.md]] - Декодер, используемый в Loong
- [[../kandinsky_video_5.md]] - Другая модель генерации видео
- [[../../../computer_vision/diffusion_transformer.md]] - Альтернативная архитектура для генерации видео
- [[../generative_models.md]] - Общая информация о генеративных моделях

## Источники

1. [Loong: Generating Minute-level Long Videos with Autoregressive Language Models](https://arxiv.org/html/2410.02757v1) - Оригинальная статья о модели Loong, описывающая архитектуру и методы генерации длительных видео
2. [CV Time разбор статьи](https://www.themoonlight.io/en/review/loong-generating-minute-level-long-videos-with-autoregressive-language-models) - Обзор и анализ ключевых аспектов модели Loong