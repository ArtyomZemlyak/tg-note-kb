# Сравнение архитектур мультимодальных LLM

## Описание

При интеграции различных модальностей (таких как текст и изображения) в одну модель LLM существует множество архитектурных подходов. В статье о X-Fusion сравниваются четыре базовые архитектуры, каждая из которых предлагает разные способы объединения текстовой и визуальной обработки в единой системе.

## Четыре базовые архитектуры

### 1. Единообразная обработка (Unified Processing)

#### Описание
- Одна и та же трансформерная модель обрабатывает как текстовые, так и визуальные входы
- Визуальные данные преобразуются в формат, совместимый с текстовыми данными
- Общая архитектура для всех модальностей

#### Преимущества
- Простота архитектуры
- Возможность общего представления для разных модальностей
- Потенциал для кросс-модального обучения

#### Недостатки
- Сложность адаптации одной модели под разные типы данных
- Потенциальная потеря специфичности для каждой модальности
- Проблемы с масштабированием сложности

#### Примеры
- CLIP с общим энкодером для изображений и текста
- BLIP с единой архитектурой для понимания и генерации

### 2. Слои с вентилями (Gated Layers)

#### Описание
- Каждый слой оригинальной LLM дублируется с вентильным (gated) слоем для визуальной модальности
- Обучаются только визуальные слои, текстовые остаются замороженными
- Результаты комбинируются с весами, визуальный выход домножается на обучаемый скаляр

#### Преимущества
- Сохранение оригинальных текстовых навыков
- Контроль над вкладом визуальной модальности
- Возможность адаптации под конкретные задачи

#### Недостатки
- Увеличение параметров модели
- Сложность в настройке вентилей
- Потенциальные проблемы с балансировкой модальностей

#### Примеры
- Адаптивные архитектуры с модулями, управляемыми условиями
- Модели с условными вычислениями (conditional computation)

### 3. Двойная проекция (Dual Projection)

#### Описание
- Копируются и дообучаются QKV-матрицы (Query-Key-Value) и MLP (Multi-Layer Perceptron) для визуальной модальности
- Основная архитектура LLM остается неизменной
- Отдельные проекции для текста и изображений

#### Преимущества
- Четкая модульность
- Возможность специализации для каждой модальности
- Сохранение оригинальной архитектуры

#### Недостатки
- Увеличение количества параметров
- Сложность в интеграции результатов
- Потенциальная избыточность

#### Примеры
- Модели с отдельными энкодерами для разных модальностей
- Архитектуры с проекционными слоями для объединения модальностей

### 4. Две башни (Two Towers) - Финальный вариант X-Fusion

#### Описание
- Полностью отдельные модели: одна для текстовой модальности, другая для визуальной
- Одна башня заморожена (сохраняет текстовые навыки)
- Вторая башня дообучается для визуальной модальности
- Выходы могут использоваться отдельно или комбинироваться с весами

#### Преимущества
- Полная специализация для каждой модальности
- Сохранение оригинальных навыков без влияния
- Гибкость в использовании выходов
- Эффективность вычислений при необходимости использовать только одну модальность

#### Недостатки
- Увеличение общего размера модели
- Сложность интеграции при необходимости объединения модальностей
- Потенциальные проблемы с кросс-модальным пониманием

#### Примеры
- X-Fusion - основной пример двухбашенной архитектуры
- Модели с отдельными энкодерами для разных модальностей

## Сравнительная таблица

| Архитектура | Сложность | Сохранение навыков | Кросс-модальность | Вычислительная эффективность | Примерная производительность в задаче генерации изображений |
|-------------|-----------|-------------------|-------------------|----------------------------|-----------------------------------------------------------|
| Единообразная | Средняя | Низкая | Высокая | Высокая | Средняя |
| Слои с вентилями | Высокая | Высокая | Средняя | Средняя | Выше средней |
| Двойная проекция | Высокая | Высокая | Средняя | Средняя | Выше средней |
| Две башни | Средняя | Очень высокая | Низкая | Высокая | **Высшая** (в X-Fusion) |

## Результаты X-Fusion

Согласно статье, **архитектура с двумя башнями** превосходит другие базовые решения в задачах создания изображений. Это связано с:

1. **Специализацией**: Каждая башня может быть оптимизирована под свою модальность
2. **Сохранением навыков**: Замороженная текстовая башня сохраняет свои способности без влияния обучения визуальной башни
3. **Эффективностью**: Возможность использовать только нужную башню в зависимости от задачи

## Применение в X-Fusion

В фреймворке X-Fusion двухбашенная архитектура реализована следующим образом:

- **Текстовая башня**: Замороженная предобученная LLM для стабильной обработки текстовых задач
- **Визуальная башня**: Дообученная копия той же LLM для работы с изображениями
- **Обработка изображений**: Кодируются VAE от Stable Diffusion 1.5 и подаются в визуальную башню
- **Генерация изображений**: Выбор токенов → диффузионный процесс → декодирование VAE

## Влияние на производительность

### Текстовая генерация
- В X-Fusion текстовая генерация не улучшает качество описаний изображений
- Это указывает на ограниченную кросс-модальную синергию в двухбашенной архитектуре

### Генерация изображений
- Двухбашенная архитектура показала лучшие результаты в задачах создания изображений
- Это связано с возможностью специализации визуальной башни

## Вызовы и ограничения архитектур

### Общие вызовы:
- Обеспечение согласованности между модальностями
- Сохранение качества по каждой модальности
- Эффективное обучение с минимальной деградацией навыков

### Специфичные для архитектур:
- **Единообразная**: Сложность в адаптации одной архитектуры под разные типы данных
- **Слои с вентилями**: Сложность в настройке баланса между модальностями
- **Двойная проекция**: Потенциальная избыточность параметров
- **Две башни**: Ограниченная кросс-модальная интеграция

## Будущие направления

### 1. Гибридные архитектуры
- Комбинация преимуществ разных подходов
- Адаптивное переключение между архитектурами в зависимости от задачи

### 2. Динамические вентили
- Автоматическое определение, какие части модели использовать для каждой модальности
- Адаптивное взвешивание вкладов разных модальностей

### 3. Улучшенная кросс-модальность
- Лучшие методы интеграции между двумя башнями
- Сохранение специализации при улучшении межмодального взаимодействия

### 4. Эффективные масштабирования
- Адаптация архитектур под большие масштабы
- Методы снижения вычислительной сложности при сохранении специализации

## Связи с другими темами

- [[x_fusion.md]] - Основная статья о фреймворке X-Fusion и его архитектуре
- [[dual_tower_architecture.md]] - Подробное описание двухбашенной архитектуры
- [[diffusion_llm_integration.md]] - Интеграция диффузионных моделей в архитектуры
- [[../../computer_vision/multimodal_models.md]] - Общие мультимодальные модели
- [[../architectures/cross_modality_efficient_architectures.md]] - Эффективные кросс-модальные архитектуры
- [[glm_46v.md|GLM-4.6V]] - Современная мультимодальная модель с нативной интеграцией вызова инструментов

## Источники

1. [CV Time Article: X-Fusion: Introducing New Modality to Frozen Large Language Models](https://cvtime.substack.com/) - Основная статья с описанием и сравнением архитектур
2. [Learning Transferable Visual Models From Natural Language Supervision](https://arxiv.org/abs/2103.00020) - CLIP, пример единообразной обработки
3. [BLIP: Bootstrapping Language-Image Pre-training for Unified Vision-Language Understanding and Generation](https://arxiv.org/abs/2201.12086) - Пример архитектуры с проекционными слоями