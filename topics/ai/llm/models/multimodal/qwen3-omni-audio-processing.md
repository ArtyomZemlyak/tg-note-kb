# Обработка аудио в Qwen3-Omni

## Общий обзор

Qwen3-Omni значительно улучшил возможности обработки аудио по сравнению с предыдущими версиями. Модель поддерживает широкий спектр аудиофункций, включая распознавание речи (ASR), понимание аудио и генерацию речи на многих языках.

## Архитектура аудиообработки

### Новый аудиоэнкодер

- Вместо дообучения Whisper, авторы обучают свою encoder-decoder-модель с нуля
- После обучения декодер выбрасывается, а энкодер используется для кодирования аудио в Qwen3-Omni
- Более сильный downsampling factor: 8 вместо 4 (применяется более сжатое представление в аудиомодальности, фреймы по 80 мс вместо 40 мс)

### Тренировка аудиоэнкодера

- Использовали 20 млн часов аудио для обучения под разные задачи
- 80% - задача ASR на китайские и английские псевдолейблы
- 10% - задача ASR для других языков
- 10% - задача audio understanding

### Особенности обучения

- Использовалась window attention с разными размерами окна
- Позволяет модели одинаково хорошо работать в офлайн-сценариях (с большим контекстом) и в стриминговом режиме (с коротким)

## Генерация аудио

### Новая схема генерации

В генерации аудио произошли значительные изменения:

- Помимо Talker, используются ещё две модели: MTP-модуль (авторегрессионная dense-модель размером 80М) и Code2Wav (декодер для кодеков, сверточная модель размером 200М)
- Работают с RVQ-токенами (Residual Vector Quantization)

### Процесс генерации

1. Поверх Talker есть линейный слой, который предсказывает нулевой кодбук
2. С помощью MTP-модели, вместо того, чтобы предсказывать оставшиеся RVQ-токены последовательно, предсказываются сразу все (multi token prediction)
3. Полученные RVQ-токены подаются в модель Code2Wav, которая преобразует их в вейвформу (waveform)

### Преимущества новой схемы

- Более эффективная, чем в Qwen2.5-Omni
- В предыдущей версии использовались трансформерные модели для отображения в мел-спектрограмму и только затем - в вейвформу

## Потоковая обработка аудио

### Асинхронный prefilling

- Как только Thinker заканчивает prefilling для текущего чанка, его выходы отдаются в Talker, чтобы он тоже мог начать prefilling
- При этом Thinker уже начинает обрабатывать следующий чанк

### Левый контекст для генерации

- Используют только левый контекст для генерации аудио
- В отличие от Qwen2.5-Omni, где создавалась задержка из-за необходимости накопить немного правого контекста

## Языковая поддержка

- **Speech-understanding**: 19 языков
- **Speech-generation**: 10 языков
- Поддерживает межъязыковой voice cloning

## Performance

- Превосходит в музыкальных задачах
- Сильна в ASR (китайский, английский)
- Поддерживает межъязыковой voice cloning

## Сравнение с предыдущими версиями

[[qwen3-omni.md|Qwen3-Omni]] - Общая информация о модели
[[qwen3-omni-video-processing.md|Обработка видео в Qwen3-Omni]] - Подробная информация о видеообработке