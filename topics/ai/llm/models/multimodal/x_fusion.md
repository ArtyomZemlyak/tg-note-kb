# X-Fusion: Интеграция новой модальности в замороженные большие языковые модели

## Описание

X-Fusion - это инновационный фреймворк, который расширяет возможности замороженных больших языковых моделей (LLM), добавляя им возможность генерации изображений без потери способности эффективно обрабатывать текст. Это делает его важным шагом в направлении универсальных мультимодальных моделей, которые могут одновременно обрабатывать и генерировать как текст, так и визуальный контент.

## Контекст и проблематика

Современная индустрия стремится унифицировать подходы к обработке различных видов данных. Визуально-языковые модели (VLM) уже успешно решают значительную часть задач компьютерного зрения, генерируя текст на основе изображений и запросов. Следующий логичный шаг - наделить модели возможностью генерировать изображения на основе текста или других условий.

Основная проблема заключается в том, что изображения, в отличие от текста, являются недискретными данными. Поэтому для них лучше работают вариации диффузионных лоссов, а не традиционное предсказание следующего токена (next-token prediction). X-Fusion решает эту проблему, объединяя два типа лоссов в одной системе.

## Архитектура X-Fusion

X-Fusion использует оригинальную схему с двумя башнями (dual-tower architecture):

### Две идентичные предобученные LLM
- **Первая модель**: Замороженная, сохраняет стабильную способность к обработке текстовых задач
- **Вторая модель**: Названа "визуальной башней", дообучается для работы с изображениями

### Обработка изображений
- Изображения кодируются с помощью Variational Autoencoder (VAE) от Stable Diffusion 1.5
- Закодированные изображения подаются на вход визуальной башне
- Генерация текста происходит через предсказание следующего токена

### Генерация изображений
- Для создания изображений выбираются токены
- Токены денойзятся (освобождаются от шума) через диффузионный процесс
- Результат декодируется с использованием VAE

## Базовые архитектуры, сравниваемые в исследовании

Авторы сравнили четыре базовые архитектуры:

1. **Единообразная обработка**: Текстовые и визуальные входы обрабатываются одной и той же трансформерной моделью
2. **Слои с вентилями (Gated layers)**: Каждый слой LLM дублируется с вентильным слоем. Обучаются только визуальные слои, результаты складываются, визуальный выход домножается на обучаемый скаляр
3. **Двойная проекция**: Копируются и дообучаются матрицы QKV и MLP для визуальной модальности
4. **Две башни (финальный вариант)**: Одна башня используется для текстовой модальности, вторая - для визуальной. Затем выходы могут либо использоваться отдельно, либо суммироваться с определенными весами

## Обучение X-Fusion

X-Fusion обучался на синтетических данных:
- Для генерации описаний (caption) использовалась модель InternVL-2.0 26B
- Для задач text-to-image использовался внутренний датасет компании

## Результаты и выводы

- Подход с двумя башнями превосходит другие базовые решения в задачах создания изображений
- Однако задача генерации текста не способствует получению качественных описаний изображений (captioning)
- Исследование показало, что зашумление входных латентных представлений для задач распознавания изображений не приносит улучшений и приводит к деградации качества

## Значение и применение

X-Fusion представляет собой важный шаг в развитии мультимодальных систем, демонстрируя возможность расширения возможностей существующих LLM без повторного полного обучения. Это позволяет:
- Сохранить уже приобретенные текстовые навыки модели
- Добавить способность к визуальной генерации
- Эффективно использовать вычислительные ресурсы за счет архитектуры с двумя башнями

## Сравнение с другими мультимодальными моделями

| Модель | Архитектура | Тип задач | Особенности |
|--------|-------------|-----------|-------------|
| X-Fusion | Две башни | Текст → Текст, Текст/Изображение → Изображение | Сохраняет замороженную текстовую башню |
| CLIP | Единый энкодер | Сопоставление изображений и текста | Контрастивное обучение |
| Imagen | Текст в изображение | Текст → Изображение | Использует предобученную языковую модель T5 |

## Связи с другими темами

- [[../../computer_vision/multimodal_models.md]] - Общие мультимодальные модели
- [[../architectures/diffusion/diffusion_llm_architectures.md]] - Диффузионные архитектуры LLM
- [[../../computer_vision/vision_transformer.md]] - Визуальные трансформеры
- [[../variational_autoencoders.md]] - Вариационные автоэнкодеры, используемые в архитектуре

## Источники

1. [CV Time Article: X-Fusion: Introducing New Modality to Frozen Large Language Models](https://cvtime.substack.com/) - Основная статья, описывающая фреймворк X-Fusion, с подробным объяснением архитектуры и результатов