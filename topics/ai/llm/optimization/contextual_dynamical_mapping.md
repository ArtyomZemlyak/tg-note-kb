# Contextual Dynamical Mapping (CDM)

## Определение

Contextual Dynamical Mapping (CDM) — это метод кросс-токенизаторной дистилляции, представленный в работе "Enhancing Cross-Tokenizer Knowledge Distillation with Contextual Dynamical Mapping". Метод улучшает подход Universal Logit Distillation (ULD), выравнивая токены двух моделей и маскируя токены, соответствия которым не были найдены.

## Контекст

CDM был разработан как улучшение для Universal Logit Distillation (ULD), который использует расстояние Вассерштейна для дистилляции знаний между моделями с разными токенизаторами. ULD имеет две основные проблемы:
1. Обрезание длины генерации до более короткой, из-за чего теряется информация из конца генерации
2. Возможность дистилляции несовпадающих по смыслу токенов друг в друга

## Основные особенности

- **Алайминг токенов**: CDM выравнивает токены у двух моделей для лучшего соответствия
- **Маскировка неалайнящихся токенов**: Токены, соответствия которым не были найдены, маскируются
- **Улучшенное качество**: Позволяет получить еще несколько процентов качества по сравнению с ULD

## Принцип работы

CDM работает следующим образом:

1. Производится алайминг (сопоставление) токенов между двумя моделями
2. Для токенов, которые не имеют соответствий, применяется маскировка
3. Выполняется дистилляция с учетом полученного сопоставления

## Преимущества

- **Улучшенное качество**: Повышает качество дистилляции по сравнению с ULD
- **Учет мисалигнмента**: Решает проблему сопоставления токенов между моделями
- **Снижение ошибок дистилляции**: Помогает избежать дистилляции несоответствующих по смыслу токенов

## Недостатки

- **Потеря информации через маскирование**: Маскировка неалайнящихся токенов может приводить к потере части информации
- **Зависимость от качества выравнивания**: Качество дистилляции зависит от точности алайминга

## Сравнение с другими методами

- **ULD**: CDM улучшает ULD за счет выравнивания токенов
- **GOLD**: GOLD в дальнейшем улучшает подход CDM, складывая логпробы вместо маскировки неалайнящихся токенов
- **Hard-label дистилляция**: CDM использует мягкую дистилляцию и работает с распределениями, а не только с топ-1 токенами

## Связи с другими темами

- [[universal_logit_distillation.md]] - предшественник метода CDM
- [[gold_method.md]] - метод, улучшающий CDM
- [[knowledge_distillation.md]] - основы дистилляции знаний
- [[distillation_challenges.md]] - проблема мисалигнмента токенизаторов
- [[tokenization_strategies.md]] - стратегии токенизации, влияющие на необходимость CDM
- [[on_policy_distillation.md]] - общий контекст дистилляции по политике
- [[wasserstein_distance.md]] - математическая основа, используемая в ULD (методе, который улучшает CDM)
- [[model_optimization.md]] - общая область применения

## Источники

1. [Enhancing Cross-Tokenizer Knowledge Distillation with Contextual Dynamical Mapping](https://arxiv.org/abs/) - оригинальная статья о методе CDM
2. [Huggingface Blog Post on GOLD](https://huggingface.co/blog/gold) - объяснение контекста и сравнения с другими методами