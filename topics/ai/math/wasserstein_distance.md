# Расстояние Вассерштейна (Wasserstein Distance)

## Определение

Расстояние Вассерштейна (также известное как "Earth Moving Distance" или "расстояние земляного перемещения") - это мера расстояния между двумя вероятностными распределениями. Оно представляет собой минимальную "работу", необходимую для преобразования одного распределения в другое.

## Математическое определение

Для двух распределений P и Q, расстояние Вассерштейна первого порядка определяется как:

W₁(P, Q) = inf E[||X - Y||]

где infimum берется по всем совместным распределениям (X, Y), маргиналы которых равны P и Q соответственно.

## Интуитивное понимание

Если представить два распределения как две кучи песка одинаковой массы, то расстояние Вассерштейна - это минимальное количество работы, которое нужно выполнить, чтобы преобразовать одну кучу в другую. "Работа" определяется как масса, умноженная на расстояние перемещения.

## Применение в дистилляции знаний

В контексте кросс-токенизаторной дистилляции (например, Universal Logit Distillation), расстояние Вассерштейна используется для сравнения логитов моделей-учителя и ученика, которые имеют разные размеры из-за различий в токенизаторах.

### Преимущества использования в дистилляции:

1. **Сравнение распределений разного размера**: Может использоваться для определения расстояния между двумя распределениями неодинакового размера
2. **Более чувствительное к геометрии**: Лучше отражает геометрические свойства распределений по сравнению с KL-дивергенцией
3. **Стабильность обучения**: Более стабильное для градиентного обучения

## Сравнение с другими метриками

| Метрика | Сравнение распределений разного размера | Геометрическая чувствительность | Стабильность градиентов |
|---------|---------------------------------------|-------------------------------|------------------------|
| KL-дивергенция | Нет | Низкая | Иногда проблематична |
| Расстояние Вассерштейна | Да | Высокая | Хорошая |

## Проблемы и ограничения

1. **Вычислительная сложность**: Расчет точного расстояния Вассерштейна может быть вычислительно затратным
2. **Сложность аппроксимации**: Для высокоразмерных распределений сложно точно аппроксимировать
3. **Требует сортировки**: В приложениях (как в ULD) требует сортировки вероятностей

## Связи с другими темами

- [[universal_logit_distillation.md]] - применение расстояния Вассерштейна в кросс-токенизаторной дистилляции
- [[knowledge_distillation.md]] - использование альтернативных метрик в дистилляции
- [[distillation_challenges.md]] - решение проблемы мисалигнмента токенизаторов
- [[math/optimal_transport_theory.md]] - математический фундамент расстояния Вассерштейна

## Источники

1. [Wasserstein GAN](https://arxiv.org/abs/1701.07875) - применение расстояния Вассерштейна в нейронных сетях
2. [Optimal Transport for Machine Learning](https://arxiv.org/abs/2006.07214) - обзор применения оптимального транспорта в машинном обучении