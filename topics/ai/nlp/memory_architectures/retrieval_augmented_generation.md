# Retrieval-Augmented Generation (RAG): Теория и практика

## Определение

Retrieval-Augmented Generation (RAG) - это архитектура, которая объединяет возможности поисковых систем и языковых моделей (LLM) для генерации ответов на основе внешних знаний. В отличие от традиционных подходов, где все знания зашиты в параметрах модели, RAG извлекает релевантные документы из внешнего источника и использует их как контекст для генерации ответов.

## Архитектура

### Компоненты RAG

1. **Индексатор**: преобразует документы во внутреннее представление (обычно векторы)
2. **Ретривер**: находит релевантные документы на основе запроса пользователя
3. **Генератор**: создает ответ на основе запроса и извлеченных документов
4. **Реранкер (опционально)**: пересортировывает извлеченные документы по релевантности

### Типы RAG

1. **RAG-Token** - извлекает документы для каждого токена генерации
2. **RAG-Sequence** - извлекает документы один раз для всей последовательности
3. **Fine-tuned RAG** - параметры ретривера и генератора дообучаются совместно

## История и развитие

### Истоки

- Первоначально предложена в 2020 году в работе "Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks"
- Стала решением проблемы ограниченных знаний в предобученных моделях
- Позволила моделям использовать актуальную информацию без переобучения

### Современные подходы

- Интеграция с векторными базами данных
- Использование сложных стратегий чанкинга
- Применение реранжирования для улучшения качества
- Агентные RAG-системы с вызовом инструментов

## Преимущества

- **Использование актуальных данных**: не требует переобучения для обновления знаний
- **Интерпретируемость**: можно отследить, какие документы были использованы
- **Контролируемость**: можно управлять составом знаний через индекс
- **Масштабируемость**: возможность добавления новых источников информации

## Ограничения

- **Качество ретривала**: зависит от качества векторного поиска
- **Затраты на инфраструктуру**: необходимы векторные базы данных
- **Задержка**: дополнительное время на извлечение информации
- **Шум в данных**: извлеченные документы могут содержать релевантные и нерелевантные фрагменты

## Современные практики

### Лучшие практики

- [[rag/best_practices/overview.md]] - общие рекомендации по RAG практикам
- [[rag/best_practices/chunking_strategies.md]] - стратегии разбиения текста на фрагменты
- [[rag/best_practices/vector_databases.md]] - выбор векторных баз данных
- [[rag/best_practices/embedding_models.md]] - модели эмбеддингов
- [[rag/best_practices/reranking.md]] - реранжирование результатов поиска
- [[rag/best_practices/llm_selection.md]] - выбор языковых моделей
- [[rag/best_practices/agentic_rag.md]] - агентные RAG-системы
- [[rag/best_practices/frameworks.md]] - фреймворки для RAG-систем

## Сравнение с другими подходами

### RAG vs Fine-tuning

- **RAG**: динамическое обновление знаний, интерпретируемость, без переобучения
- **Fine-tuning**: глубокая интеграция знаний, стабильность, но требует переобучения

### RAG vs Langchain/Memories

- **RAG**: фокус на поиске и использовании внешней информации
- **Langchain**: фокус на оркестрации компонентов и вызове инструментов

## Реализации и фреймворки

- [[rag/best_practices/frameworks.md]] - популярные фреймворки для RAG-систем
- [[../llm/models/generative_models.md]] - генеративные модели, используемые в RAG

## Связи с другими темами

- [[../../llm/memory/llm_memory_overview.md]] - обзор систем памяти для LLM
- [[rag/index.md]] - справочник по RAG системам
- [[rag/best_practices/case_studies_and_resources.md]] - кейсы и полезные ресурсы
- [[../nlp/transformers/long_context_transformers.md]] - альтернативы RAG с долгим контекстом
- [[../../agents/agent_architectures.md]] - интеграция RAG с агентными системами
- [[../../graphs/knowledge_graphs.md]] - графы знаний как альтернативное представление знаний, отличное от традиционного текстового подхода RAG
- [[../../graphs/wikontic.md]] - современный подход к извлечению графов знаний, альтернатива традиционному текстовому контексту RAG

## Источники

1. [Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks (2020)](https://arxiv.org/abs/2005.11401) - оригинальная статья, предложившая архитектуру RAG
2. [Best RAG Practices (2024)](https://arxiv.org/abs/2407.01219) - комплексное исследование современных подходов и бест-практик RAG систем
3. [Langchain Documentation](https://python.langchain.com/docs/use_cases/question_answering/) - документация о различных подходах к RAG с использованием Langchain
4. [RAG vs Fine-tuning: Hybrid Strategy for Dynamic Updates](https://t.me/neuraldeep/1124) - исследование Google DeepMind о балансировке fine-tuning и RAG