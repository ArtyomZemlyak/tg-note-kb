# Rotary Positional Embeddings (RoPE) и их модификации

## Определение
Rotary Positional Embeddings (RoPE) - это форма позиционного кодирования, используемая в трансформерах, которая кодирует позиционную информацию через вращение векторов запросов и ключей. В отличие от традиционных абсолютных позиционных эмбеддингов, RoPE интегрирует позиционную информацию в сам механизм внимания.

## Формула и механизм
RoPE работает путем применения вращательных матриц к эмбеддингам запроса (q) и ключа (k) на основе их позиции в последовательности. Для позиции j это выражается как:
- q_j → RoPE(q_j, j) 
- k_j → RoPE(k_j, j)

## Преимущества RoPE
- **Относительное позиционирование**: Модель лучше понимает отношения между токенами
- **Длина обобщения**: Лучшая интерполяция на более длинные последовательности, чем с абсолютными эмбеддингами
- **Интеграция с вниманием**: Позиционная информация встроена непосредственно в механизм внимания

## Модификации RoPE
### Rotary Time Embeddings (RoTE)
RoTE - это расширение RoPE, адаптированное для мультимодальных моделей, где позиционная информация может быть не только дискретной (как в традиционном RoPE), но и непрерывной (например, время в секундах). RoTE использует реальные временные метки для определения углов поворота эмбеддингов.

### Constrained Rotary Time Embedding (CRTE)
CRTE - это модификация RoTE, в которой вводится дополнительный гиперпараметр T_max, добавляемый в знаменатель при вычислении базовых частот. Это позволяет лучше учитывать связи между близко расположенными эмбеддингами. В CRTE углы поворота также определяются с использованием реальных временных меток, как в RoTE: Ω_{i,j} = ω_i · t_j, где t_j - реальная временная метка.

## Применение в моделях
RoPE широко используется в современных архитектурах трансформеров, включая:
- LLaMA
- Qwen
- Mamba-3 (через комплексную динамику)
- OmniVinci (через CRTE)

## Источники

1. [RoFormer: Enhanced Transformer with Rotary Position Embedding](https://arxiv.org/abs/2104.09864) - Оригинальная статья о RoPE
2. [Llama: Open Foundation and Fine-Tuned Chat Models](https://arxiv.org/abs/2302.13971) - Применение RoPE в архитектуре Llama
3. [OmniVinci: Enhancing Architecture and Data for Omni-Modal Understanding LLM](https://arxiv.org/abs/2510.15870) - Введение CRTE как модификации RoTE