# Процесс обучения DeepSeek-OCR

## Общее описание

Обучение DeepSeek-OCR включает в себя упрощенный подход с двумя основными стадиями: обучение визуального энкодера и обучение всей модели целиком. Это отличает DeepSeek-OCR от более сложных многоступенчатых подходов, используемых в других VLM.

## Этапы обучения

### 1. Обучение DeepEncoder

Важным аспектом является то, что во время тренировки энкодера DeepEncoder обучается работать как в режиме native-resolution, так и в режиме tile-based-resolution. Это означает, что модель видит как большие, так и маленькие изображения в разных представлениях, что улучшает её универсальность.

#### Архитектура DeepEncoder

DeepEncoder представляет собой пайплайн, состоящий из:
- **SegmentAnything (SAM-ViT-Det)**: Может принимать на вход изображение любого размера; токенизированные патчи обрабатываются независимо друг от друга благодаря window attention — поэтому количество вычислений уменьшается.
- **Свёрточный адаптер**: Снижает количество токенов в 16 раз
- **CLIP (CLIP-ViT)**: Глобальный аттеншн в CLIP-ViT агрегирует токены

#### Метод обучения энкодера

Энкодер обучается по схеме, описанной в статье Vary: к нему подключается маленький текстовый декодер, и они вместе обучаются авторегрессивно. Это позволяет эффективно обучать визуальный компонент на парах изображение-описание.

### 2. Обучение всей VLM

Второй этап обучения повторяет стандартный претрейн/SFT (Supervised Fine-Tuning), используемый во многих других VLM. В процессе используется смесь пар (изображение-описание) и только текстовых данных с упором на OCR: печатный текст, графики и таблицы, формулы.

#### Особенности датасета

- В отличие от других OCR-специализированных VLM (обычно обучаемых только на английском и китайском), датасеты содержат более 100 языков
- Упор на OCR-задачи: печатный текст, графики и таблицы, формулы
- Смешение визуально-текстовых пар и чисто текстовых данных

## Преимущества двухэтапного подхода

- **Упрощение процесса**: В отличие от сложных многоступенчатых подходов, используется всего две стадии
- **Гибкость**: Обучение в разных режимах разрешения улучшает адаптивность модели
- **Эффективность**: Сокращение вычислительных затрат за счёт оптимизированной архитектуры
- **Кроссплатформенность**: Поддержка мультиязычных данных в датасете

## Особенности архитектуры

DeepSeek-OCR архитектурно повторяет стандартную схему для VLM: визуальный энкодер, подключенный к предобученной языковой модели (в данном случае DeepSeek-3B). Однако используется не стандартный CLIP/SigLIP, а описанный выше DeepEncoder пайплайн.

## Результаты обучения

- Модель показывает отличное качество на OmniDocBench, опережая не только сильные опенсорсные бэйзлайны, вроде Qwen-2.5VL, но и Gemini2.5-Pro
- Скорость обработки на GPU сопоставима с пайплайновыми OCR-пакетами, обрабатывая около двух изображений в секунду на A100
- Для надёжного чтения текста можно использовать примерно в 10 раз меньше визуальных токенов, чем необходимо текстовых токенов для представления текста на изображении

## Сравнение с другими моделями

В статье отмечается, что хотя результаты получились впечатляющими, в работе использовались только бенчмарки с фокусом на PDF-подобных картинках, а другие, более разнообразные OCR-бенчи для VLM (OCRBench_v2, CC-OCR) не замерялись.

## Связи с другими темами

- [[deepseek_ocr.md]] - Общее описание модели и её применения
- [[specialized_vlm_models.md]] - Контекст других специализированных OCR-VLM моделей
- [[dynamic_resolution_approaches.md]] - Подробное описание подходов к динамическому разрешению, использованных в модели
- [[vlm_models.md]] - Общая архитектура визуально-языковых моделей

## Источники

1. [DeepSeek-OCR: Contexts Optical Compression](https://arxiv.org/abs/2510.18234) - Основная статья, описывающая архитектуру и процесс обучения DeepSeek-OCR
2. [Vary: Scaling up the Vision Vocabulary of Large Language Models](https://arxiv.org/abs/2311.01940) - Методология, использованная для обучения энкодера (подключение маленького текстового декодера)
3. [CV Time: DeepSeek-OCR разбор статьи](https://towardsai.net/p/machine-learning/deepseek-ocr-contexts-optical-compression-paper-review) - Детальный разбор статьи о DeepSeek-OCR с акцентом на архитектуру и обучение