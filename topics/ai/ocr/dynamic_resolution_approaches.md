# Подходы к динамическому разрешению в VLM

## Общее описание

Первые визуально-языковые модели (VLM), такие как LLaVA, использовали статический размер изображения: любое изображение для обработки масштабировалось до фиксированного квадрата, а затем подавалось через энкодер (например, CLIP), создавая визуальные токены для входа в языковую модель. Так как входное изображение может быть как пиксельной строкой текста 128×16, так и большим фото со смартфона 1500×4500 пикселей, статический размер работает не оптимально. Современные VLM используют динамическое разрешение для более эффективной обработки изображений различного размера.

## Tile-based-resolution (Разрешение на основе тайлов)

### Общая информация

Tile-based-resolution (например, в модели Intern-VL2) - подход, при котором изображение разрезается на квадраты (например, 512×512 пикселей), и каждая часть прогоняется через визуальный энкодер. Все выходные токены (чем больше размер изображения, тем больше тайлов и токенов) подаются на вход языковой модели.

### Особенности

- Изображение делится на фиксированные тайлы
- Каждый тайл обрабатывается независимо
- Количество визуальных токенов пропорционально количеству тайлов
- Подходит для обработки больших изображений
- Масштабируемость: можно обрабатывать изображения любого размера

### Примеры реализации

- **Intern-VL2**: Использует тайловый подход для обработки изображений переменного размера

## Native-resolution (Собственное разрешение)

### Общая информация

Native-resolution (например, в модели Qwen-VL2) - подход, при котором визуальный энкодер обучается принимать на вход изображение любого размера, используя подходящие позиционные эмбеддинги, такие как RoPE (Rotary Position Embedding).

### Особенности

- Поддержка изображений любого размера без предварительной сегментации
- Использование гибких позиционных эмбеддингов (например, RoPE)
- Сохранение пространственных отношений между элементами изображения
- Потенциально более точная обработка мелких деталей
- Прямая обработка изображения без разбиения на части

### Примеры реализации

- **Qwen-VL2**: Использует native-resolution подход для обработки изображений переменного размера

## Сравнение подходов

| Критерий | Tile-based-resolution | Native-resolution |
|----------|----------------------|-------------------|
| Обработка больших изображений | + Эффективная, с разбиением | + Возможна, с сохранением деталей |
| Пространственные отношения | - Могут теряться между тайлами | + Сохраняются между частями |
| Вычислительная сложность | + Предсказуемая по тайлам | + Может варьироваться |
| Архитектурная сложность | + Проще реализация | - Требует специальных эмбеддингов |
| Подходящие задачи | + OCR, таблицы, документы | + Общие визуальные задачи |

## Применение в DeepSeek-OCR

DeepSeek-OCR интересен тем, что во время тренировки энкодера модель обучается работать как в режиме native-resolution, так и в режиме tile-based-resolution. Это позволяет модели воспринимать как большие, так и маленькие картинки в разных представлениях, что повышает универсальность её применения.

## Преимущества динамических подходов

- **Гибкость**: Возможность обрабатывать изображения различных размеров
- **Эффективность**: Адаптация количества вычислений к размеру изображения
- **Качество**: Лучшее сохранение деталей по сравнению с фиксированными размерами
- **Универсальность**: Единая модель для различных типов изображений

## Связи с другими темами

- [[deepseek_ocr.md]] - Модель, использующая оба подхода во время обучения
- [[vlm_models.md]] - Общее описание визуально-языковых моделей
- [[qwen3-vl.md]] - Пример VLM, использующей native-resolution подход
- [[computer_vision/vision_transformer.md]] - Архитектура Vision Transformer, лежащая в основе визуальных энкодеров

## Источники

1. [Resolving Resolution Dilemmas in Vision-Language Models](https://arxiv.org/html/2506.12776v1) - Исследование подходов к обработке разрешения в VLM, включая native-resolution encoding
2. [Native Visual Understanding: Resolving Resolution Dilemmas in VLMs](https://www.themoonlight.io/en/review/native-visual-understanding-resolving-resolution-dilemmas-in-vision-language-models) - Описание NativeRes-LLaVA как фреймворка для эффективной обработки изображений в их родном разрешении
3. [DeepSeek-OCR: Contexts Optical Compression](https://arxiv.org/abs/2510.18234) - Исследование DeepSeek-OCR, где оба подхода используются в процессе обучения