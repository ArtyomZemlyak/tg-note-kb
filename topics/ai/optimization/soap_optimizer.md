# SOAP - Оптимизатор для адаптивного предобуславливания (Stochastic Optimizer for Adaptive Preconditioning)

## Описание

SOAP (Stochastic Optimizer for Adaptive Preconditioning) - это современный оптимизатор, который улучшает и стабилизирует алгоритм Shampoo. SOAP представляет собой адаптивный метод предобуславливания, который сочетает в себе элементы отбеливания матриц и адаптации дисперсии, что делает его особенно эффективным для обучения нейронных сетей.

## Механизм работы

SOAP является вариантом Shampoo, который:
- Поддерживает оценки ковариационных матриц градиентов
- Применяет полное матричное предобуславливание, которое адаптирует направление оптимизации с учетом геометрии ландшафта потерь
- В отличие от Muon, не стремится к идеальной спектральной нормализации, а скорее фокусируется на общем предобуславливании

## Особенности

1. **Высокая эффективность несмотря на неточную спектральную нормализацию**: В исследовании "What Really Matters in Matrix-Whitening Optimizers?" было обнаружено, что SOAP, который выполняет менее строгую спектральную нормализацию (соотношение сингулярных значений 2-3), превосходит Muon (с соотношением, близким к 1).

2. **Адаптация дисперсии**: SOAP включает адаптацию дисперсии как ключевой компонент, что объясняет его превосходную производительность.

3. **Улучшенная стабильность**: SOAP стабилизирует процесс обучения по сравнению с базовым Shampoo.

## Структура оптимизатора

SOAP использует подход SPlus (Shampoo с дополнительными улучшениями), но включает адаптацию дисперсии, что отличает его от его аналога со знаковым спуском (SPlus).

## Превосходство над другими оптимизаторами

В ключевом исследовании SOAP показал лучшую производительность по сравнению с Muon, несмотря на менее точную спектральную нормализацию. Это открытие стало важным вкладом в понимание матричных отбеливающих оптимизаторов - оно указывает на то, что адаптация дисперсии может быть даже более важной, чем точная спектральная нормализация.

## Практическое значение

SOAP демонстрирует, что:
- Превосходство оптимизаторов не обязательно связано с точным следованием направлению наискорейшего спектрального спуска
- Адаптация дисперсии является критически важным, но часто упускаемым из виду компонентом
- Комбинация различных механизмов может привести к превосходной производительности

## Сравнение с другими оптимизаторами

- В отличие от Muon, SOAP менее точно нормализует сингулярные значения, но достигает лучшего результата
- В отличие от Shampoo, SOAP включает дополнительные механизмы стабилизации
- Превосходит свои аналоги со знаковым спуском (SPlus) за счет адаптации дисперсии

## Интеграции и упоминания

- [[matrix_whitening_optimizers.md]] - Контекст семейства матричных отбеливающих оптимизаторов
- [[muon_optimizer.md]] - Сравнение с Muon, который уступает SOAP
- [[shampoo_optimizer.md]] - Родительский оптимизатор Shampoo
- [[optimizer_quantization_relationship.md]] - Исследование показывает, что SOAP выигрывает на меньших моделях без квантования, но не превосходит другие оптимизаторы при квантовании

## Ссылки на источники

- Zhang, S., et al. (2024). SOAP: Improving and Stabilizing Shampoo. https://arxiv.org/abs/2409.11321
- Frans, K., Abbeel, P., & Levine, S. (2024). What Really Matters in Matrix-Whitening Optimizers? https://arxiv.org/abs/2510.25000