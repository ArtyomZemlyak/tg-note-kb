# TTGL: Graph Learning at TikTok

## Описание

TTGL (Graph Learning at TikTok) - это фундаментальная графовая модель, разработанная для рекомендательных систем в TikTok. Модель создает единое представление интересов пользователей и объектов, объединяя данные из различных сценариев и доменов TikTok.

![TTGL: Graph Learning at TikTok](../../../media/img_1765027576_aqaddatrgzboul_ttgl_graph_learning_at.jpg)

**Изображение показывает:** Сценарии TTGL - видео-фид, поиск, лайв-стримы, e-commerce. Цель - единое представление интересов пользователей и объектов, где пользователи, видео, авторы, запросы, товары находятся в общем семантическом пространстве. Масштаб TTGraph: 12.6 млрд вершин, 198 млрд рёбер.

## Контекст и мотивация

TikTok - это платформа с несколькими сценариями взаимодействия:
- Видео-фид
- Поиск
- Лайв-стримы
- E-commerce

Цель TTGL - создать единую систему представлений для всех этих сценариев.

## Масштаб

- **TTGraph** (TikTok graph): 12.6 млрд вершин, 198 млрд рёбер
- Один из самых больших промышленных графов для рекомендаций

## Цель

- Единое представление интересов пользователей и объектов
- Пользователи, видео, авторы, запросы, товары в общем семантическом пространстве
- Foundation graph model для всей экосистемы TikTok

## Архитектура

### Гетерогенный граф

TTGraph - это гетерогенный граф, содержащий:
- Пользователей
- Видео
- Авторов
- Запросы
- Товары
- И другие типы узлов

### Unsupervised Graph Learning

TTGL использует подходы unsupervised learning на графе:
- **Random walks**: для генерации "предложений" из вершин
- **Skip-gram**: обучение эмбеддингов на последовательностях узлов
- Нет необходимости в размеченных данных

## Методология

### Случайные блуждания

#### Выбор source вершины:
- 50%: сэмплирование пропорционально степени вершины в графе
- 50%: перевзвешивание вершин так, чтобы были представлены все типы вершин

#### Выбор ребра:
- Нормализация весов ребер так, чтобы суммарный вес каждого типа ребра = 1
- Глубина блуждания: 12
- Отказ от метапутей в пользу кастомной стратегии сэмплирования

### Unsupervised обучение

#### Положительные пары:
- Вершина и её соседи в окне размера 4 при блуждании

#### Лосс:
- Sampled softmax

#### Негативы:
- Вершины того же типа, что и позитив
- Сэмплируются пропорционально степени вершины (популярные вершины чаще в негативах)
- Country-aware negative sampling: отдельные пулы негативов по странам

## Применение

### Ежедневное обновление

- Ежедневно перестраивается граф и дообучаются эмбеддинги
- Это позволяет учитывать динамические изменения в поведении пользователей

### Генерация кандидатов

- **1-hop**: ближайшие соседи в HNSW-индексе
- **2-hop**: соседи соседей для повышения разнообразия

### Ранжирование

- Использование графовых эмбеддингов как признаков в моделях
- Генерация дополнительных обучающих примеров с помощью графовых эмбеддингов

## Результаты A/B тестирования

- **+0.35% 7-day retention**
- **+3.27% watch live duration**
- **+1.32% GMV** (Gross Merchandise Volume)
- **+1% search page views**

### Детализированные результаты по сценариям:

- **Feed Retrieval**: улучшение коллаборативных интересов и обобщение интересов
- **Search Retrieval**: улучшение интересов при поиске
- **Live**: увеличение продолжительности просмотра
- **Push**: улучшение распределения высококачественных запросов
- **E-commerce**: увеличение GMV и числа новых платящих пользователей

## Преимущества

- **Единство представлений**: единая модель для разных сценариев
- **Масштабируемость**: обучение на огромном графе
- **Динамичность**: ежедневные обновления
- **Интеграция доменов**: взаимное улучшение разных приложений за счет общей модели

## Ограничения

- **Высокая вычислительная сложность**: обучение на графе с 12.6 млрд вершин
- **Требования к памяти**: хранение и обработка больших эмбеддингов
- **Сложность балансировки**: разные сценарии и типы данных

## Связи с другими темами

- [[graph_neural_networks_for_recommendations.md]] - Общее описание графовых моделей в рекомендациях
- [[TwHIN.md]] - Сравнение с аналогичной гетерогенной графовой моделью в Twitter
- [[foundation_graph_models.md]] - Пример Foundation Graph Model для экосистемы
- [[unsupervised_graph_learning.md]] - Подходы к обучению без учителя на графах
- [[traditional_approaches.md]] - Современное развитие графовых методов

## Источники

1. [TTGL: Graph Learning at TikTok] - оригинальная статья о TTGL
2. [TikTok's Recommendation System Evolution] - эволюция рекомендательных систем в TikTok
3. [Foundation Graph Models in Large-Scale Recommender Systems] - общие материалы о фундаментальных графовых моделях
4. [Unsupervised Graph Learning for Recommender Systems] - методы обучения без учителя на графах для рекомендаций