# Генерация кандидатов (Candidate Generation) в рекомендательных системах

## Описание

Генерация кандидатов - первый этап в двухуровневой архитектуре рекомендательных систем, где из огромного каталога айтемов отбирается небольшое подмножество потенциальных рекомендаций, которые затем передаются на этап ранжирования. Основная цель этапа - эффективно сократить пространство поиска с миллионов айтемов до сотен кандидатов, при этом сохранив наивысшую вероятность того, что среди них будут действительно релевантные пользователю айтемы.

## Традиционные подходы

### Двух-башенные модели (Two-Tower Models)
- Архитектура с двумя отдельными нейронными сетями: одна для пользователей, другая для айтемов
- Обе модели обучаются генерировать эмбеддинги, которые затем сравниваются для определения схожести
- Используются коллаборативные сигналы и признаки пользователей/айтемов
- Примеры: DNN-Rec, YouTube DNN

### Матричная факторизация (Matrix Factorization)
- Представление пользовательско-айтемной матрицы как произведения двух низкоразмерных матриц
- Основана на идее, что пользователи и айтемы могут быть представлены в общем пространстве скрытых факторов
- Примеры: SVD, NMF, FunkSVD

### Контент-базированные методы (Content-Based Methods)
- Рекомендации строятся на основе схожести айтемов по их описанию
- Используются признаки айтемов и профиль пользователя
- Менее зависимы от холодного старта для айтемов

## Современные подходы

### LLM-базированная кандидат-генерация

#### Подход LinkedIn ("Large Scale Retrieval...")
- Замена двух отдельных башен на единую LLM
- Использование текстового представления айтемов вместо Semantic IDs
- Файнтюн предобученной LLM для генерации эмбеддингов
- Использование Matryoshka learning для сжатия эмбеддингов
- Обучение на InfoNCE loss с Hard Negatives

#### Подход Alibaba (RecGPT)
- Использование последовательности из нескольких LLM для разных задач
- Генерация промежуточных представлений (интересов, тегов) с помощью LLM
- Финальные рекомендации строятся не-LLM 3-башенной моделью
- Лучшая масштабируемость за счет легкой DNN для финального этапа

#### Подходы Google/Kuaishou с Semantic IDs
- Использование специальных токенов, представляющих айтемы в пространстве LLM ("говорить на языке айтемов")
- Прямое предсказание айтемов с помощью LLM
- Использование знаний, закодированных в LLM, для улучшения рекомендаций

## Метрики оценки

- **Recall@K**: Доля релевантных айтемов, попавших в топ-K кандидатов
- **MRR (Mean Reciprocal Rank)**: Среднее обратное ранжирование релевантных айтемов
- **Hit Rate@K**: Вероятность того, что хотя бы один релевантный айтем попадет в топ-K
- **Coverage**: Покрытие каталога (доля айтемов, которые могут быть рекомендованы)
- **Diversity**: Разнообразие рекомендованных кандидатов

## Вызовы и ограничения

1. **Масштаб**: Необходимость обрабатывать миллионы айтемов в реальном времени
2. **Качество**: Баланс между эффективностью и точностью отбора
3. **Холодный старт**: Работа с новыми пользователями и айтемами
4. **Контекст**: Интеграция временных, сессионных и других контекстуальных факторов
5. **Долгосрочное значение**: Учет долгосрочных интересов пользователей
6. **Длина пользовательской истории**: Ограничения при подаче длинных последовательностей в модели (особенно в LLM). Решения включают [[llm_based/vista_architecture.md]] - архитектуру VISTA от Meta, которая позволяет обрабатывать пожизненную историю пользователя до 1M событий с фиксированной стоимостью инференса.

## Литература

- "Recommender Systems: The Textbook" - Charu Aggarwal
- "Hands-On Recommendation Systems with Python" - Rounak Banik
- "Two Towers Architecture for Recommendations" - YouTube recommendation paper

## Связи с другими темами

- [[ranking.md]] - Ранжирование: второй этап рекомендательного пайплайна
- [[llm_based/llm_candidate_generation_approaches.md]] - Сравнительный анализ LLM-базированных подходов
- [[llm_based/linkedin_large_scale_retrieval.md]] - Подход LinkedIn к LLM-кандидат-генерации
- [[llm_based/recgpt/main.md]] - Подход Alibaba (RecGPT) к LLM-кандидат-генерации
- [[tbgrecall.md]] - TBGRecall: генеративная модель next-session prediction от Alibaba
- [[session_based_recommendations.md]] - Сессионные рекомендательные системы: контекст для понимания сессионного подхода TBGRecall
- [[traditional_approaches.md]] - Традиционные подходы к рекомендательным системам