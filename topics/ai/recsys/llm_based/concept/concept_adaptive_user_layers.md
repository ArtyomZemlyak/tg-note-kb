# Концепт 2: Модель с адаптивными пользовательскими слоями (Adaptive User Layer LLM)

## Описание концепта

В этой архитектуре базовая LLM остается неизменной, но для каждого пользователя создаются адаптивные слои, которые вставляются в различные уровни модели. Эти слои содержат персонализированную информацию о пользователе и активируются во время инференса, позволяя модели учитывать предпочтения конкретного пользователя без изменения всей архитектуры.

## Архитектура

### Базовая LLM
- Статичная часть модели (например, Llama-3 70B или Qwen-2 72B)
- Обучена на общем корпусе, не изменяется для разных пользователей

### Адаптивные пользовательские слои
- **Вложение пользовательского профиля**: Компактное представление пользовательских предпочтений
- **Персонализированные FFN-слои**: Адаптируют промежуточные представления для конкретного пользователя
- **Условные нормализации**: Модули, адаптирующие нормализацию на основе пользовательского контекста
- **Динамические эмбеддинги внимания**: Пользовательские векторы, влияющие на механизм внимания

### Модуль агрегации профиля
- Собирает данные из всех трех сервисов (Самокат, Мегамаркет, Купер)
- Создает иерархическое представление профиля с таймингом
- Интегрирует внешние факторы (погода, сезон, локация)

### Механизм вызова слоев
- Условная активация на основе запроса пользователя
- Возможность переключения между разными "режимами" пользователя (например, "голодный", "шопинг", "здоровье")
- Автоматическое определение релевантных аспектов профиля

## Обучение

### Инициализация
- Базовая модель предобучена на общем корпусе
- Пользовательские слои инициализируются случайными весами

### Адаптация
- Для каждого нового пользователя обучается только его адаптивный слой
- Используется метод LoRA (Low-Rank Adaptation) или аналогичный для эффективности
- Обновления пользовательских слоев могут происходить онлайн

### Обновление профиля
- Периодическое обновление слоев на основе новой активности
- Учет временной деградации интересов
- Приватное обновление с использованием дифференциальной приватности

## Преимущества

- Эффективность: только небольшие адаптивные слои уникальны для каждого пользователя
- Быстрая адаптация к новым пользователям
- Сохранение общего знания модели
- Возможность быстрого переключения между контекстами

## Ограничения

- Неопределенность в определении оптимального количества адаптивных слоев
- Возможная потеря качества при очень специфических запросах
- Требуется сложная система управления пользовательскими слоями
- Потенциальные проблемы с совместимостью слоев разных пользователей