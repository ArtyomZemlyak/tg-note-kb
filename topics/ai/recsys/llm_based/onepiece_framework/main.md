# OnePiece: Фреймворк для контекстной инженерии и ризонинга в промышленных каскадных ранжирующих системах

## Описание

OnePiece - это инновационный фреймворк, разработанный Shopee (популярная торговая площадка в Южной Америке и Азии), который адаптирует большие языковые модели (LLM) для задач извлечения (retrieval) и ранжирования (ranking) в рекомендательных системах.

## Основные идеи

Подход OnePiece основан на трех ключевых концепциях:

1. **Структурированная контекстная инженерия (Structured context engineering)**: Обогащение истории взаимодействия пользователей для повышения качества рекомендаций.
2. **Блочное латентное рассуждение (Block-wise latent reasoning)**: Интеграция способности LLM к логическим рассуждениям в рекомендательные системы.
3. **Прогрессивное многозадачное обучение (Progressive multi-task training)**: Постепенное усложнение обучающих задач для учета обратной связи пользователей.

## Архитектура

Система следует стандартному двухступенчатому подходу, принятому в современных рекомендательных системах:

### Этап извлечения (Retrieval)
- Входные данные: история взаимодействий пользователей, описания контекста через пользовательские признаки
- Особенность: Использование "якорей предпочтений" (preference anchors), которые помогают формировать топы товаров на основе количества покупок, добавлений в корзину или кликов
- Эти "якоря" можно рассматривать как аналог RAG (Retrieval-Augmented Generation) для рекомендательных систем

### Этап ранжирования (Ranking)
- То же, что и на этапе извлечения, плюс множество кандидатов (аналог подхода с target-aware трансформерами)
- Использует тот же трансформерный энкодер в основе

## Технические детали

- **Базовая архитектура**: трансформерный энкодер (модель не очень большая по косвенным признакам)
- **Представление товаров**: набор ID (название, магазин, категория)
- **Представление запросов**: мешок слов
- **Токенизация**: MLP над конкатенацией эмбеддингов

Для оптимизации вычислений и избежания артефактов в зависимостях кандидаты делятся на случайные группы и подаются на вход по одной.

## Значение

OnePiece представляет собой интересный подход к интеграции возможностей LLM в промышленные рекомендательные системы, особенно благодаря внедрению компонента ризонинга, который позволяет системе логически обосновывать свои рекомендации.