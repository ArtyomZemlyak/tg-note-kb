# OneTrans: Единая архитектура для взаимодействия признаков и моделирования последовательностей в промышленных рекомендательных системах

## Описание

OneTrans - это нейросетевая ранжирующая модель, разработанная TikTok, которая объединяет моделирование последовательностей (sequence modeling) и взаимодействие признаков (feature interaction) в едином трансформерном блоке. Модель заменяет финальный ранкер в каскадном стеке рекомендательной системы, одновременно обрабатывая как последовательные, так и не-последовательные входы в рамках единой архитектуры.

## Контекст проблемы

Традиционный подход к финальному ранжированию в промышленных рекомендательных системах обычно предполагает раздельную обработку истории пользователя и ручных счётчиков. Сначала входная последовательность событий обрабатывается через блок моделирования последовательностей (Sequence Modeling Block), где извлекается и сжимается информация о пользователе. Затем сжатое представление направляется в блок взаимодействия (Interaction-блок). Параллельно набор не-последовательных признаков (Non-Seq-фичи, например, ручные счётчики) конкатенируется или подаётся иным способом в тот же Interaction-блок.

## Архитектурное решение

OneTrans одновременно моделирует как последовательные (S), так и не-последовательные (NS) входы внутри единой модели. Архитектура включает в себя:

1. **Токенизация**: Последовательности (голубые блоки S) и не-последовательные айтемы (NS, оранжевые) токенизируются отдельно
2. **Разделение поведенческих блоков**: Блоки поведения пользователей разделяются специальными токенами [SEP]
3. **Единая последовательность**: После токенизации формируется единая последовательность, подаваемая на вход OneTrans Pyramid Stack
4. **Пирамидальная структура**: Внутри пирамиды последовательность S итеративно сжимается до тех пор, пока её длина не совпадёт с NS

![Архитектура OneTrans: объединение моделирования последовательностей и взаимодействия признаков](../../../media/img_1764244068_aqadvwxrg4xsmel_image.jpg)

**Описание:** На изображении представлена архитектура OneTrans, показывающая, как последовательные (S) и не-последовательные (NS) элементы обрабатываются в единой трансформерной архитектуре с использованием пирамидальной структуры для сжатия последовательных данных до сопоставимой длины с не-последовательными признаками.

## OneTrans Block

OneTrans Block представляет собой казуальный (каузальный) трансформер с:
- **RMSNorm** (Root Mean Square Normalization) для стабилизации обучения
- **Mixed Causal Attention** (смешанное причинное внимание)
- **Mixed FFN** (смешанные Feed-Forward Networks)

Под "Mixed" авторы понимают смешанную параметризацию:
- У токенов последовательностей (S-токенов) общие матрицы QKV/FFN
- Каждый не-последовательный токен (NS) получает свои специфичные для токена веса

## Сравнение с аналогами

OneTrans можно рассматривать как аналог следующих архитектур:
- **HSTU** (Hierarchical Semantic Transformer for User Behavior Modeling) от Meta
- **TransAct** от Pinterest
- **RankMixer** и **Wukong**, на которые авторы ссылаются, но не подробно анализируют

Однако OneTrans отличается тем, что объединяет моделирование последовательностей и взаимодействие признаков в единой архитектуре, что делает его похожим на подход InterFormer (используемый в GEM), где также решается проблема интеграции разных типов признаков.

## Экспериментальные результаты

- OneTrans эффективно масштабируется с ростом параметров
- Систематически превосходит сильные бейзлайны
- Показывает рост на 5,68% per-user GMV (Gross Merchandise Value) в онлайн A/B-тестах

## Связи с другими темами

- [[transformer_based_models.md]] - Трансформерные модели в системах рекомендаций: контекст для понимания архитектуры OneTrans
- [[target_aware_architectures_in_ranking.md]] - Target Aware архитектуры в ранжировании: OneTrans как один из подходов с ранним связыванием с историей
- [[interformer_architecture.md]] - InterFormer: архитектура с динамическим чередованием признаков, решает похожую задачу интеграции разных типов признаков
- [[rankmixer_mtgr_transact_v2.md]] - RankMixer, MTGR и TransAct V2: современные Target Aware архитектуры, с которыми сравнивается OneTrans
- [[wukong_component.md]] - Компонент Wukong: упоминаемый в статье как похожая работа
- [[gem_model.md]] - GEM: архитектура, использующая похожий подход к интеграции последовательных и не-последовательных признаков через InterFormer

## Источники

1. [OneTrans: Unified Feature Interaction and Sequence Modeling with One Transformer in Industrial Recommender] - оригинальная статья о OneTrans, нейросетевой ранжирующей модели от TikTok, объединяющей моделирование последовательностей и взаимодействие признаков
2. [Разбор статьи OneTrans от @RecSysChannel](https://t.me/RecSysChannel) - разбор статьи с объяснением ключевых аспектов архитектуры OneTrans, подготовленный Артёмом Матвеевым