# YouTube DNN - Архитектура рекомендательной системы

## Описание

YouTube DNN (Deep Neural Networks) - это знаменитая архитектура рекомендательной системы, представленная в статье "Deep Neural Networks for YouTube Recommendations" от команды YouTube. Это одна из первых и наиболее влиятельных архитектур, применивших глубокие нейронные сети для рекомендаций на промышленном уровне. Архитектура представляет собой двух-башенную модель, которая обучает эмбеддинги пользователей и айтемов (видео) для эффективной генерации кандидатов.

## Контекст и проблема

YouTube сталкивался с рядом вызовов при построении рекомендательной системы:
- **Масштаб**: Миллиарды пользователей и миллионы видео
- **Разреженность**: Большинство пользователей взаимодействуют только с небольшим подмножеством контента
- **Изменчивость контента**: Новые видео добавляются постоянно
- **Неточность метаданных**: Автосгенерированные теги и категории
- **Скрытая цель**: Сложность определения истинной удовлетворенности пользователя

Оригинальная архитектура YouTube DNN была разработана для решения этих проблем с использованием глубокого обучения.

## Архитектура YouTube DNN

![YouTube DNN: Retrieval (Candidate Generation)](../../../media/img_1764244291_aqadlqxrg8dukel_youtubednn_retrieval.jpg)

**Изображение показывает:** Архитектуру YouTube DNN для генерации кандидатов (retrieval), включая обучаемые эмбеддинги для video ID, суммирование эмбеддингов просмотренных видео, добавление признаков истории поисковых запросов (мешок униграмм/биграмм), региона, устройства, языка и других признаков, с формированием эмбеддинга пользователя.

### Основные компоненты

#### 1. User Tower (Пользовательская башня)
- Обрабатывает историю просмотров пользователя
- Интегрирует признаки пользователя (демография, регион, устройство)
- Обрабатывает историю поисковых запросов
- Генерирует эмбеддинг пользователя в фиксированном пространстве

#### 2. Item Tower (Айтемная башня)
- Обрабатывает признаки видео (категории, теги, тайтлы)
- Использует текстовые эмбеддинги и визуальные признаки
- Генерирует эмбеддинг видео в том же пространстве, что и пользовательские эмбеддинги

#### 3. Механизм схожести
- Использует косинусное сходство или скалярное произведение
- Позволяет эффективно находить релевантные айтемы для пользователя

![YouTube DNN: Ranking](../../../media/img_1764244291_aqadlgxrg8dukel_youtubednn_ranking.jpg)

**Изображение показывает:** Архитектуру YouTube DNN для ранжирования, включая использование MLP вместо линейной модели, возможность использования большего количества признаков на этапе ранжирования из-за меньшего количества кандидатов, и раннее связывание user x item через счетчики взаимодействий (например, "сколько раз этот пользователь лайкал этого автора").

### Архитектурные детали

#### Входные признаки

**Пользовательские признаки:**
- История просмотров (встроенные эмбеддинги видео)
- Поисковые запросы (меш униграмм/биграмм)
- Демографические данные (регион, устройство, язык)
- Статистика (среднее время просмотра, частота просмотров)

**Айтемные признаки:**
- Признаки видео (категория, теги, продолжительность)
- Текстовые признаки (тайтл, описание)
- Статистика (CTR, время просмотра, лайки/дислайки)

#### Обработка истории

- Последовательность просмотренных видео суммируется (bag of words)
- Используется взвешивание, чтобы более недавние видео имели больший вес
- Текстовые признаки из поисковых запросов также суммируются

#### Обучение модели

- Задача многоклассовой классификации: предсказать следующее видео, которое пользователь посмотрит
- Используется sampled softmax для эффективного обучения на миллионах классов
- Обучение с использованием стохастического градиентного спуска

## Применение в рекомендательных системах

YouTube DNN используется для:
- **Генерации кандидатов** - первого этапа в двухступенчатом пайплайне рекомендаций
- **Создания эмбеддингов** - для пользователей и видео в одном пространстве
- **Быстрого поиска** - схожих пользователей и видео

### Преимущества

1. **Масштабируемость**: Способность обрабатывать миллионы видео и пользователей
2. **Обобщение**: Способность рекомендовать новые видео, не виденные в тренировке
3. **Гибкость**: Возможность интеграции различных типов признаков
4. **Эффективность инференса**: Быстрый поиск рекомендаций за счет предвычисленных эмбеддингов
5. **Обработка разреженности**: Эффективная работа с разреженными признаками пользователей

### Ограничения

1. **Сложность обучения**: Необходимость обучать на миллиардах примеров
2. **Проблема холодного старта**: Трудности с новыми пользователями и видео
3. **Фиксированное представление**: Отсутствие учета контекста просмотра
4. **Задержки обновления**: Модель не адаптируется в реальном времени

## Современные адаптации

YouTube DNN стала основой для множества современных архитектур:
- **Two-tower модели** в других компаниях (Netflix, Amazon, Pinterest)
- **Интеграция с трансформерами** для учета последовательности событий
- **Многозадачные адаптации** для предсказания нескольких метрик одновременно
- **Контекстуальные адаптации** с использованием дополнительной информации

## Сравнение с другими архитектурами

| Архитектура | Масштабируемость | Обобщение | Контекст | Сложность |
|-------------|------------------|-----------|----------|-----------|
| Коллаборативная фильтрация | Средняя | Низкое | Нет | Низкая |
| Факторизационные машины | Средняя | Среднее | Ограниченное | Средняя |
| **YouTube DNN** (настоящее) | **Высокая** | **Высокое** | **Ограниченное** | **Высокая** |
| Трансформеры в рекомендациях | Высокая | Высокое | Высокое | Очень высокая |
| Генеративные рекомендации | Высокая | Очень высокое | Высокое | Очень высокая |

## Практические примеры использования

YouTube DNN и её вариации используются в промышленных рекомендательных системах:
- **YouTube** - оригинальная реализация
- **Netflix** - двух-башенные модели для рекомендаций
- **Amazon** - для рекомендаций товаров
- **Pinterest** - для рекомендаций пинов
- **TikTok** - как часть рекомендательного пайплайна

## Связи с другими темами

- [[candidate_generation.md]] - YouTube DNN как пример двух-башенной модели для генерации кандидатов
- [[hse_dl2_neural_recsys.md]] - Упоминается в лекции по нейросетевым рекомендательным системам в HSE
- [[unified_embeddings.md]] - Современное развитие подхода с унификацией эмбеддингов
- [[traditional_approaches.md]] - Контраст с традиционными методами рекомендаций
- [[transformer_based_models.md]] - Современная альтернатива с учетом последовательности
- [[ranking.md]] - YouTube DNN используется на этапе кандидат-генерации перед ранжированием

## Источники

1. [Deep Neural Networks for YouTube Recommendations] - Оригинальная статья команды YouTube о архитектуре DNN
2. [YouTube DNN Retrieval Architecture] - Техническая документация по реализации
3. [HSE DL2 Course Materials] - Материалы курса Deep Learning 2 на ФКН ВШЭ, где разбиралась архитектура YouTube DNN

## Дополнительные материалы

- [[two_tower_models.md]] - Обобщение концепции двух-башенных моделей
- [[embeddings_in_recsys.md]] - Обзор эмбеддингов в рекомендательных системах
- [[youtubednn_ranking.md]] - Дополнительная архитектура YouTube для этапа ранжирования