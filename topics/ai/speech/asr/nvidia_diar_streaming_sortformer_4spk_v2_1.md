# NVIDIA Diar Streaming Sortformer 4spk-v2.1: Потоковая модель диаризации дикторов

```metadata
category: ai
subcategory: speech
tags: nvidia, diarization, sortformer, speaker recognition, asr, streaming, real-time
```

## Описание

NVIDIA Diar Streaming Sortformer 4spk-v2.1 — это продвинутая потоковая (онлайн) модель диаризации дикторов, разработанная NVIDIA для идентификации и маркировки различных дикторов в реальном времени. Модель способна обнаруживать до 4 дикторов одновременно и эффективно работает с аудио в реальном времени, разрешая проблему перестановки (permutation problem) в диаризации, следуя порядку появления дикторов.

## Основные характеристики

- **Потоковая обработка**: Разработана для обработки аудио в реальном времени с минимальной задержкой
- **Сортировка дикторов**: Уникально сортирует дикторов на основе времени их первого появления в аудиозаписи
- **Ограничение дикторов**: Оптимизирована для обнаружения до 4 дикторов (качество снижается с 5+ дикторами)
- **Кэш дикторов**: Использует Arrival-Order Speaker Cache (AOSC) для хранения акустических эмбеддингов ранее обнаруженных дикторов
- **Высокая точность**: Показывает передовые результаты с низким Diarization Error Rate (DER)

## Техническая архитектура

- **Общая архитектура**: Потоковый (онлайн) Sortformer с Arrival-Order Speaker Cache (AOSC)
- **Энкодер**: L-размер (17 слоев) NeMo Encoder for Speech Tasks (NEST) на основе энкодера Fast-Conformer
- **Трансформер**: 18-слойный энкодер трансформера с размером скрытого слоя 192
- **Выход**: Два полносвязных слоя с 4 выходами сигмоиды для каждого входного фрейма в верхнем слое
- **Инновация**: Использует предварительный энкодерный слой в Fast-Conformer для генерации кэша дикторов с фильтрацией для сохранения только высококачественных векторов кэша дикторов

## Технические спецификации

- **Формат входа**: Монофоническое аудио с частотой дискретизации 16,000 Гц
- **Входной тензор**: Матрица Ns x 1, где Ns - количество аудиосемплов
- **Выход**: Матрица T x S, где S=4 (макс. дикторы) и T - общее количество фреймов (каждый фрейм = 0.08 секунд)
- **Выходные значения**: Вероятности активности дикторов в диапазоне [0, 1]
- **Параметры потоковой обработки** (измеряются в 80мс фреймах):
  - CHUNK_SIZE: Размер обрабатываемого чанка
  - RIGHT_CONTEXT: Будущие фреймы после чанка
  - FIFO_SIZE: Предыдущие фреймы из очереди FIFO
  - UPDATE_PERIOD: Фреймы, извлекаемые для обновления кэша дикторов
  - SPEAKER_CACHE_SIZE: Общее количество фреймов в кэше дикторов

## Конфигурации задержки

- **Очень высокая задержка**: 30.4с задержка (RTF: 0.002) с CHUNK_SIZE=340, RIGHT_CONTEXT=40, FIFO_SIZE=40, UPDATE_PERIOD=300, SPEAKER_CACHE_SIZE=188
- **Низкая задержка**: 1.04с задержка (RTF: 0.093) с CHUNK_SIZE=6, RIGHT_CONTEXT=7, FIFO_SIZE=188, UPDATE_PERIOD=144, SPEAKER_CACHE_SIZE=188

## Обучение и данные

- **Объем данных**: Около 5,000 часов аудио, объединяющих реальные разговоры и симулированные аудиосмеси
- **Реальные разговоры**: Fisher English, AMI Meeting Corpus, VoxConverse-v0.3, ICSI, AISHELL-4, DiPCo, AliMeeting, NOTSOFAR1
- **Симулированные смеси**: NIST Speaker Recognition Evaluation, Librispeech
- **Размер выборки**: 90-секундные сэмплы с batch размером 4 на 8×NVIDIA Tesla V100 GPU на узле через 8 узлов

## Результаты производительности (DER - Diarization Error Rate)

- **DIHARD III Eval (v2.1)**: 19.49% (полный), 14.84% (≤4 дикторов), 38.90% (≥5 дикторов)
- **CALLHOME-part2 (v2.1)**: 10.10% (полный), с уменьшающейся производительностью при увеличении количества дикторов
- **Meeting Speech Corpus (v2.1)**: 11.73% (AliMeeting near), 15.95% (AMI Test IHM), 27.07% (NOTSOFAR1 full)

## Практические применения

- **Реальное время диаризации дикторов**: Идеально подходит для обработки в реальном времени
- **Аналитика колл-центров**: Разделение потоков агента/клиента для контроля качества или соблюдения норм
- **Конференции и собрания**: Транскрипции с разметкой по дикторам в реальном времени
- **Аudiо контент-анализ**: Автоматическая маркировка для редактирования и модерации
- **Голосовые боты и ИИ-ассистенты**: Более естественный диалог, корректное соблюдение очереди выступлений и отслеживание идентичности
- **Деловые и нормативные нужды**: Аудируемые, разрешенные по дикторам логи для нормативных требований

## Технические ограничения

- Ограничена 4 дикторами максимум (качество снижается с 5+ дикторами)
- В основном обучена на английской речи
- Может ухудшать качество на зашумленных условиях или не-английской речи
- Может ухудшать качество на очень длительных записях несмотря на то, что разработана для длинных записей

## Сравнение с традиционными методами

- **Производительность в продакшене**: Открытая модель диаризации уровня продакшена (в отличие от предыдущих методов пакетной обработки)
- **Низкий Diarization Error Rate (DER)**: Сравнение с другими потоковыми системами, такими как EEND-GLA и LS-EEND
- **Устойчивое отслеживание дикторов**: С минимальной задержкой
- **Оптимизация для GPU**: Эффективный инференс на GPU для развертывания
- **Интеграция**: С NVIDIA NeMo и NVIDIA Riva workflow
- **Языковая универсальность**: Оптимизирована для английского, но протестирована на китайском и других языках

## Связь с другими моделями

В отличие от базовой модели Sortformer, Streaming Sortformer 4spk-v2.1 оптимизирована для реального времени с кэшем дикторов, что позволяет эффективно отслеживать дикторов на протяжении длинных аудиосессий. Она часто используется как предварительный этап в многоголосовых ASR-системах, таких как NVIDIA Multitalker Parakeet, для идентификации и маркировки дикторов перед распознаванием речи.

## Связи с другими темами

- [[nvidia_multitalker_parakeet_streaming.md]] - Многоголосая модель ASR, использующая выводы диаризации
- [[sortformer_speaker_diarization.md]] - Базовая архитектура Sortformer для задач диаризации
- [[speech_recognition.md]] - Общие принципы распознавания речи
- [[fast_conformer_architecture.md]] - Архитектура, на которой основана модель
- [[speaker_separation_techniques.md]] - Общие методы разделения речи различных дикторов
- [[nvidia_parakeet_architecture.md]] - Архитектура Parakeet, с которой работает модель

## Источники

1. [Hugging Face: nvidia/diar_streaming_sortformer_4spk-v2.1](https://huggingface.co/nvidia/diar_streaming_sortformer_4spk-v2.1) - Официальная страница модели
2. [NVIDIA Developer Blog: Identify Speakers in Meetings, Calls, and Voice Apps in Real-Time](https://developer.nvidia.com/blog/identify-speakers-in-meetings-calls-and-voice-apps-in-real-time-with-nvidia-streaming-sortformer/) - Информация о технологии диаризации
3. [Research Paper: Sortformer: Seamless Integration of Speaker Diarization and ASR by Bridging Timestamps and Tokens](https://arxiv.org/abs/2302.02577) - Исследование о Sortformer
4. [Research Paper: Streaming Sortformer: Speaker Cache-Based Online Speaker Diarization with Arrival-Time Ordering](https://arxiv.org/abs/2302.02578) - Исследование о потоковом Sortformer
5. [NVIDIA NeMo Framework Documentation](https://docs.nvidia.com/deeplearning/nemo/user-guide/docs/en/stable/asr/speaker_diarization/intro.html) - Документация по системам диаризации в NeMo
6. [GitHub Issue: Support for diar_streaming_sortformer_4spk-v2](https://community.groq.com/t/nvidia-diar-streaming-sortformer-4spk-v2-support-please/598) - Обсуждение качества модели

## Дополнительные материалы

- [NVIDIA NGC Catalog: Sortformer Diarizer](https://catalog.ngc.nvidia.com/orgs/nvidia/teams/riva/models/sortformer_diarizer) - Информация о применении архитектуры
- [NeMo GitHub Repository](https://github.com/NVIDIA-NeMo/NeMo) - Исходный код и документация фреймворка