# Алгоритм поиска BM25 (Best Match 25)

## Краткое описание

BM25 (Best Match 25) - это функция оценки релевантности, используемая в поисковых системах для оценки соответствия между поисковым запросом и документом. Это вероятностная модель, улучшенная версия более ранней модели TF-IDF, которая лучше учитывает длину документа и частоту терминов.

## История и развитие

BM25 является частью семейства "Best Match" моделей, разработанных Стивеном Робертсоном и Крисом Уильямсоном. Это развитие более ранних моделей TF-IDF и BM11/BM15, с улучшенной способностью оценивать релевантность документов на основе поисковых запросов.

## Математическая основа

Формула BM25 для документа D и запроса Q:

```
BM25(D,Q) = Σ(i=1 to n) IDF(qi) * (f(qi,D) * (k1 + 1)) / (f(qi,D) + k1 * (1 - b + b * (|D|/avgdl)))
```

Где:
- `qi` - термин запроса
- `f(qi,D)` - частота термина qi в документе D
- `|D|` - длина документа (число слов)
- `avgdl` - средняя длина документов в коллекции
- `k1` - параметр, регулирующий влияние частоты терминов (обычно 1.2-2.0)
- `b` - параметр, регулирующий влияние длины документа (обычно 0.75)
- `IDF(qi)` - обратная частота документа для термина qi

## Параметры BM25

### k1
- Контролирует насыщение частоты терминов
- Более высокие значения уменьшают различия между документами с низкой и высокой частотой терминов
- Обычно устанавливается в диапазоне 1.2-2.0

### b (betta)
- Контролирует влияние нормализации длины документа
- При b=0 длина документа не влияет на оценку
- При b=1 влияние полное
- Обычно устанавливается в 0.75

## Преимущества BM25

### 1. Нормализация по длине документа
- Учитывает, что более длинные документы с большей вероятностью будут содержать больше совпадений
- Предотвращает предвзятость в пользу длинных документов

### 2. Насыщение частоты терминов
- Не линейно увеличивает релевантность с ростом частоты термина
- Учитывает, что дополнительные вхождения термина после определенного порога имеют меньшую ценность

### 3. Простота и эффективность
- Относительно прост в реализации и вычислительно эффективен
- Не требует сложных моделей машинного обучения

## Применение

### Поисковые системы
- Используется для оценки релевантности документов поисковым запросам
- Является основой для многих поисковых систем и ретриверов

### Ретриверы в ИИ-системах
- [[../ai/agents/git_based_memory_systems.md]] - Git-ориентированные системы памяти для ИИ-агентов
- [[../ai/agents/diffmem_git_based_memory.md]] - DiffMem: Git-базированная дифференциальная память
- Используется для быстрого и объяснимого поиска информации

### Информационный поиск
- Использование в рекомендательных системах
- Применение в системах извлечения информации

## Сравнение с другими моделями

### TF-IDF
- BM25 улучшает TF-IDF, добавляя нормализацию по длине документа и насыщение частоты
- Обычно показывает лучшие результаты, особенно при работе с коллекциями документов разной длины

### Современные нейронные методы
- BM25 обеспечивает интерпретируемость, что не всегда возможно с нейронными моделями
- Может использоваться как компонент гибридных поисковых систем
- Работает без обучения и требует меньше вычислительных ресурсов

### Infini-gram и FM-Index
- Infini-gram использует FM-Index для точного поиска n-грамм в больших текстовых корпусах
- В отличие от BM25, который оценивает релевантность, Infini-gram обеспечивает точный поиск подстрок
- Может использоваться вместе с BM25 в гибридных системах
- См. также: [[infinigram_fm_index_search.md]]

### SPLADE
- SPLADE создает разреженные векторные представления документов
- В отличие от BM25, учитывает семантические связи между терминами
- Может использоваться в сочетании с BM25 для улучшения результатов поиска
- См. также: [[search_methods_comparison.md]]

## Реализации

### Elasticsearch
- Поддерживает BM25 как стандартную модель релевантности
- Возможность настройки параметров k1 и b

### Lucene
- Оригинальная реализация BM25 для поисковых библиотек
- Интеграция с различными системами поиска

### Python библиотеки
- rank_bm25: простая библиотека для использования BM25 в Python
- Поддержка как базового BM25, так и вариантов (BM25L, BM25+)