# Разрешение конфликтов слияния в Git

## Краткое описание

Конфликты слияния в Git возникают, когда две ветки вносят изменения в одни и те же строки кода, и Git не может автоматически определить, какие изменения сохранить. Это требует ручного вмешательства разработчика для разрешения конфликта.

## Причины возникновения конфликтов

- Изменения одной и той же строки кода в двух разных ветках
- Одновременное удаление и изменение одного и того же файла в разных ветках
- Конфликты при слиянии (merge), перебазировке (rebase) или применении патчей (cherry-pick)
- Работа нескольких разработчиков над одними и теми же частями кода

## Идентификация конфликта

Когда Git обнаруживает конфликт, он помечает затронутые файлы следующим образом:

```
<<<<<<< HEAD
Текущие изменения в вашей ветке
=======
Изменения из ветки, которую вы пытаетесь объединить
>>>>>>> имя-ветки
```

## Процесс разрешения конфликтов

### Шаг 1: Идентификация файлов с конфликтами

```bash
git status
```

Файлы с конфликтами будут отмечены как "unmerged".

### Шаг 2: Ручное редактирование файлов

Откройте каждый файл с конфликтом и найдите маркеры конфликта `<<<<<<<`, `=======`, `>>>>>>>`. Решите, какие изменения сохранить, и удалите маркеры конфликта.

### Шаг 3: Добавление файлов в индекс

```bash
git add <файл>
```

### Шаг 4: Завершение операции слияния

При использовании `git merge`:
```bash
git commit
```

При использовании `git rebase`:
```bash
git rebase --continue
```

## Инструменты для разрешения конфликтов

### Визуальные инструменты

```bash
git mergetool
```

Популярные инструменты:
- meld
- vimdiff
- p4merge
- kdiff3

### Конфигурирование предпочтительного инструмента

```bash
git config --global merge.tool <инструмент>
```

## Стратегии разрешения конфликтов

### 1. Сохранить изменения из текущей ветки (--ours)

```bash
git checkout --ours <файл>
```

### 2. Сохранить изменения из объединяемой ветки (--theirs)

```bash
git checkout --theirs <файл>
```

### 3. Сброс до состояния до конфликта

```bash
git merge --abort  # для git merge
git rebase --abort # для git rebase
```

## Рекомендации по предотвращению конфликтов

1. Регулярно обновляйте свою ветку из основной ветки
2. Создавайте небольшие, сфокусированные коммиты
3. Используйте отдельные ветки для различных функций
4. Часто публикуйте изменения в репозиторий
5. Обсуждайте архитектурные изменения перед их реализацией

## Работа с файлами, удаленными в одной ветке

Если файл был удален в одной ветке, но изменен в другой:

- Используйте `git rm` для удаления файла, если его нужно удалить
- Используйте `git add` для сохранения файла, если его нужно оставить

## Пример разрешения конфликта

Допустим, у нас есть следующий конфликт в файле `main.py`:

```
<<<<<<< HEAD
def hello():
    print("Привет от основной ветки")
=======
def hello():
    print("Привет от новой ветки")
>>>>>>> feature_branch
```

Разработчик решает сохранить версию из новой ветки и удаляет маркеры:

```python
def hello():
    print("Привет от новой ветки")
```

Затем добавляет файл в индекс и завершает операцию слияния.

## Связь с другими темами

- [[version_control_systems.md]] - Системы контроля версий
- [[git_divergent_branches_troubleshooting.md]] - Устранение ошибки "Need to specify how to reconcile divergent branches"

## Источники

1. [Git Documentation: git-merge](https://git-scm.com/docs/git-merge) - официальная документация Git о команде слияния и разрешении конфликтов
2. [Atlassian Git Tutorial: Merge Conflicts](https://www.atlassian.com/git/tutorials/using-branches/merge-conflicts) - подробное руководство по разрешению конфликтов слияния
3. [Pro Git Book: Advanced Merging](https://git-scm.com/book/en/v2/Git-Tools-Advanced-Merging) - продвинутые техники работы с конфликтами слияния